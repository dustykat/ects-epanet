
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.3 EPANET (Examples 3-5) using the Toolkit &#8212; Hydraulic Network Simulation with EPANET and Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lessons/lesson03/epanet-rulesCLI';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.4 EPANET Control Rules using the Toolkit" href="epanet-rulesAPI.html" />
    <link rel="prev" title="3.2 EPANET (Examples 1 and 2) using the Toolkit" href="epanet-rulesGUI.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Hydraulic Network Simulation with EPANET and Python - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Hydraulic Network Simulation with EPANET and Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    About this book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../lesson01/introduction.html">1 Hydraulic Networks and Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../lesson01/hydraulic-networks.html">1.2 Network Hydraulics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson01/pythonjupyter.html">1.3 Python/Jupyter Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson01/pythonhydraulics.html">1.4 Hydraulics in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson01/pythonhydraulicsmodule.html">1.5 The <code class="docutils literal notranslate"><span class="pre">pipenet</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson01/pythonpumpingmodule.html">1.6 Pumps</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lesson02/epanet-classic.html">2 EPANET Intro/Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../lesson02/epanet-gui.html">2.2 EPANET GUI Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson02/epanet-eps.html">2.3 Extended period simulation (EPS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson02/epanet-watq.html">2.4 Water Quality Simulation in EPANET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson02/epanet-rules.html">2.5 EPANET Control Rules</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="epanet-toolkit.html">3 EPANET Programmers Toolkit</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="epanet-rulesGUI.html">3.2 EPANET (Examples 1 and 2) using the Toolkit</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">3.3 EPANET (Examples 3-5) using the Toolkit</a></li>
<li class="toctree-l2"><a class="reference internal" href="epanet-rulesAPI.html">3.4 EPANET Control Rules using the Toolkit</a></li>
<li class="toctree-l2"><a class="reference internal" href="epanet-sensors.html">3.5 EPANET Sensors Integration</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lesson04/epanet-future-CandC1.html">4 Command and Control</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../lesson04/epanet-future-CandC2.html">4.2 CandC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson04/epanet-future-CandC3.html">4.X Build Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson04/epanet-future.html">4.4 Unsolved Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lesson04/epanet-exam.html">4.5 EPANET Exam</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flessons/lesson03/epanet-rulesCLI.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/lessons/lesson03/epanet-rulesCLI.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>3.3 EPANET (Examples 3-5) using the Toolkit</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose">Purpose</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-notes">Installation Notes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-3-three-reservoir-problem">Example 3 : Three-Reservoir-Problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-4-a-simple-looped-network">Example 4 - A simple looped network</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-5-simulating-a-pump">Example 5 - Simulating a Pump</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#files">Files</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="epanet-examples-3-5-using-the-toolkit">
<h1>3.3 EPANET (Examples 3-5) using the Toolkit<a class="headerlink" href="#epanet-examples-3-5-using-the-toolkit" title="Link to this heading">#</a></h1>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">#</a></h2>
<p>This section continues the demonstration of the various previous examples using the Toolkit to run the example and make changes to inputs and rerun the examples.  The main concept is that the Toolkit allows manipulation of models independent of a GUI which when combined with either Toolkit supplied control rules, or external “control” lets one model and interpret (assuming IF-THEN interpretation is amenable) many changes automatically.</p>
</section>
<section id="installation-notes">
<h2>Installation Notes<a class="headerlink" href="#installation-notes" title="Link to this heading">#</a></h2>
<p>The examples herein are run on the developmental computer (a Raspberry Pi).  The scripts should work fine on another computer with the toolkit installed (Windows probably takes a bit more fussing to get the Linux subsystem to call to the Toolkit).</p>
</section>
<section id="example-3-three-reservoir-problem">
<h2>Example 3 : Three-Reservoir-Problem<a class="headerlink" href="#example-3-three-reservoir-problem" title="Link to this heading">#</a></h2>
<p>This example is a the classic hydraulics problem, that appears in some form in most if not all hydraulics textbooks; here we will use the already built input file - and note we wont use any of the basemap capabilities, as the Toolkit is not really intended for such direct graphics.</p>
<p>Recall the <strong>problem statement</strong>:</p>
<p>Reservoirs A, B, and C are connected as shown.
The water elevations in reservoirs A, B, and C are 100 m, 80 m, and 60 m.
The three pipes connecting the reservoirs meet at junction J, with pipe AJ being 900
m long, BJ being 800 m long, and CJ being 700 m long. The diameters of
all the pipes are 850 mm. If all the pipes are ductile iron, and the water
temperature is 293<span class="math notranslate nohighlight">\(^o\)</span>K, find the direction and magnitude of flow in each
pipe.</p>
<p><img alt="" src="http://freeswmm.ddns.net/ects-epanet/ects-epanet-notes/lessons/lesson02/ex3/EX3.bmp" /></p>
<p>The input file from earlier is copiec to our work directory; let’s list it</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>cat<span class="w"> </span>./ex3-tk/EX3.inp
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[TITLE]





[JUNCTIONS]

;ID              	Elev        	Demand      	Pattern         

 NodeA           	0           	0           	                	;

 NodeB           	0           	0           	                	;

 NodeC           	0           	0           	                	;

 J               	110         	0           	                	;



[RESERVOIRS]

;ID              	Head        	Pattern         

 A               	100         	                	;

 B               	80          	                	;

 C               	60          	                	;



[TANKS]

;ID              	Elevation   	InitLevel   	MinLevel    	MaxLevel    	Diameter    	MinVol      	VolCurve        	Overflow



[PIPES]

;ID              	Node1           	Node2           	Length      	Diameter    	Roughness   	MinorLoss   	Status

 PAJ             	NodeA           	J               	900         	850         	0.1         	0           	Open  	;

 PBJ             	NodeB           	J               	800         	850         	0.1         	0           	Open  	;

 PJC             	J               	NodeC           	700         	850         	0.1         	0           	Open  	;

 4               	A               	NodeA           	10          	2400        	0.1         	0           	Open  	;

 5               	B               	NodeB           	10          	2400        	0.1         	0           	Open  	;

 6               	C               	NodeC           	10          	2400        	0.1         	0           	Open  	;



[PUMPS]

;ID              	Node1           	Node2           	Parameters



[VALVES]

;ID              	Node1           	Node2           	Diameter    	Type	Setting     	MinorLoss   



[TAGS]



[DEMANDS]

;Junction        	Demand      	Pattern         	Category



[STATUS]

;ID              	Status/Setting



[PATTERNS]

;ID              	Multipliers



[CURVES]

;ID              	X-Value     	Y-Value



[CONTROLS]



[RULES]



[ENERGY]

 Global Efficiency  	75

 Global Price       	0

 Demand Charge      	0



[EMITTERS]

;Junction        	Coefficient



[QUALITY]

;Node            	InitQual



[SOURCES]

;Node            	Type        	Quality     	Pattern



[REACTIONS]

;Type     	Pipe/Tank       	Coefficient





[REACTIONS]

 Order Bulk            	1

 Order Tank            	1

 Order Wall            	1

 Global Bulk           	0

 Global Wall           	0

 Limiting Potential    	0

 Roughness Correlation 	0



[MIXING]

;Tank            	Model



[TIMES]

 Duration           	0

 Hydraulic Timestep 	1:00

 Quality Timestep   	0:05

 Pattern Timestep   	1:00

 Pattern Start      	0:00

 Report Timestep    	1:00

 Report Start       	0:00

 Start ClockTime    	12 am

 Statistic          	None



[REPORT]

 Status             	No

 Summary            	No

 Page               	0



[OPTIONS]

 Units              	LPS

 Headloss           	H-W

 Specific Gravity   	1

 Viscosity          	1

 Trials             	40

 Accuracy           	0.001

 CHECKFREQ          	2

 MAXCHECK           	10

 DAMPLIMIT          	0

 Unbalanced         	Continue 10

 Pattern            	1

 Demand Multiplier  	1.0

 Emitter Exponent   	0.5

 Quality            	None mg/L

 Diffusivity        	1

 Tolerance          	0.01



[COORDINATES]

;Node            	X-Coord           	Y-Coord

NodeA           	1177.043          	8793.774          

NodeB           	5340.467          	7782.101          

NodeC           	8200.389          	5719.844          

J               	4659.533          	6186.770          

A               	457.198           	9046.693          

B               	4659.533          	8093.385          

C               	8375.486          	6089.494          



[VERTICES]

;Link            	X-Coord           	Y-Coord

PAJ             	1643.969          	8618.677          

PAJ             	2149.805          	8307.393          

PAJ             	2519.455          	7762.646          

PAJ             	2947.471          	7198.444          

PAJ             	3161.479          	6809.339          

PAJ             	3492.218          	6536.965          

PAJ             	3822.957          	6361.868          

PAJ             	4309.339          	6206.226          

PBJ             	5749.027          	7762.646          

PBJ             	6060.311          	7723.735          

PBJ             	6215.953          	7607.004          

PBJ             	6196.498          	7431.907          

PBJ             	5787.938          	7062.257          

PBJ             	5301.556          	6673.152          

PJC             	5340.467          	6167.315          

PJC             	6118.677          	6050.584          

PJC             	6702.335          	5856.031          

PJC             	7227.626          	5700.389          

PJC             	7636.187          	5680.934          



[LABELS]

;X-Coord             Y-Coord             Label &amp; Anchor Node



[BACKDROP]

  DIMENSIONS  	0.000             	0.000             	10000.000         	10000.000         

 UNITS          	None

 FILE           	

 OFFSET         	0.00            	0.00            



[END]
</pre></div>
</div>
</div>
</div>
<p>Now we will run it as supplied, then modify using the Toolkit for more useful purposes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>  <span class="c1"># import the package</span>
<span class="c1">#Open the EPANET toolkit &amp; hydraulics solver   </span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex3-tk/EX3.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex3-tk/EX3-tk.rpt&quot;</span><span class="p">)</span>
<span class="c1"># build report command strings Keyword  Action see user manual</span>
<span class="c1">#command0 = &quot;Status     Yes&quot;</span>
<span class="n">command1</span> <span class="o">=</span> <span class="s2">&quot;Summary            	Yes&quot;</span>
<span class="n">command2</span> <span class="o">=</span> <span class="s2">&quot;Nodes            	ALL&quot;</span>
<span class="n">command3</span> <span class="o">=</span> <span class="s2">&quot;Links            	ALL&quot;</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetstatusreport</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># full status report</span>
<span class="c1">#em.ENsetreport(command0)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">command1</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">command3</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveinpfile</span><span class="p">(</span><span class="s2">&quot;./ex3-tk/EX3-tk.inp&quot;</span><span class="p">)</span> <span class="c1">#overwrite the input file</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
<span class="c1"># now run from the new file</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex3-tk/EX3-tk.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex3-tk/EX3-tk.rpt&quot;</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span> <span class="c1"># need to save to a binary file before write</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span> <span class="c1"># now write report</span>
<span class="c1"># Close hydraulics solver &amp; toolkit */</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>  <span class="c1"># import the package</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1">#Open the EPANET toolkit &amp; hydraulics solver   </span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex3-tk/EX3.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex3-tk/EX3-tk.rpt&quot;</span><span class="p">)</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">ects</span><span class="o">-</span><span class="n">epanet</span><span class="o">/</span><span class="n">ects</span><span class="o">-</span><span class="n">epanet</span><span class="o">-</span><span class="n">notes</span><span class="o">/</span><span class="n">lessons</span><span class="o">/</span><span class="n">lesson03</span><span class="o">/</span><span class="n">epamodule</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">12</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">_plat</span><span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="k">if</span> <span class="n">_plat</span><span class="o">==</span><span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">12</span>   <span class="n">_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">&quot;./libepanet2.so&quot;</span><span class="p">)</span> <span class="c1"># For My Raspberry Pi</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1">##  _lib = ctypes.CDLL(&quot;./en2tools.so.1.5.0&quot;)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1">##  _lib = ctypes.CDLL(&quot;./epanet2toolkit.so&quot;)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="k">elif</span> <span class="n">_plat</span><span class="o">==</span><span class="s1">&#39;Windows&#39;</span><span class="p">:</span>

<span class="nn">File /usr/lib/python3.10/ctypes/__init__.py:374,</span> in <span class="ni">CDLL.__init__</span><span class="nt">(self, name, mode, handle, use_errno, use_last_error, winmode)</span>
<span class="g g-Whitespace">    </span><span class="mi">371</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FuncPtr</span> <span class="o">=</span> <span class="n">_FuncPtr</span>
<span class="g g-Whitespace">    </span><span class="mi">373</span> <span class="k">if</span> <span class="n">handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">374</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="n">_dlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">375</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="n">handle</span>

<span class="ne">OSError</span>: ./libepanet2.so: cannot open shared object file: No such file or directory
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the output</span>
<span class="o">!</span><span class="w"> </span>cat<span class="w"> </span>./ex3-tk/EX3-tk.rpt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Page 1                                    Sat Jul 29 08:57:04 2023

  ******************************************************************
  *                           E P A N E T                          *
  *                   Hydraulic and Water Quality                  *
  *                   Analysis for Pipe Networks                   *
  *                         Version 2.2                            *
  ******************************************************************
  
   
      Input Data File ................... ./ex3-tk/EX3-tk.inp
      Number of Junctions................ 4
      Number of Reservoirs............... 3
      Number of Tanks ................... 0
      Number of Pipes ................... 6
      Number of Pumps ................... 0
      Number of Valves .................. 0
      Headloss Formula .................. Hazen-Williams
      Nodal Demand Model ................ DDA
      Hydraulic Timestep ................ 1.00 hrs
      Hydraulic Accuracy ................ 0.001000
      Status Check Frequency ............ 2
      Maximum Trials Checked ............ 10
      Damping Limit Threshold ........... 0.000000
      Maximum Trials .................... 40
      Quality Analysis .................. None
      Specific Gravity .................. 1.00
      Relative Kinematic Viscosity ...... 1.00
      Relative Chemical Diffusivity ..... 1.00
      Demand Multiplier ................. 1.00
      Total Duration .................... 0.00 hrs
      Reporting Criteria:
         All Nodes
         All Links
   
  Analysis begun Sat Jul 29 08:57:04 2023

   
  Hydraulic Status:
  -----------------------------------------------------------------------
     0:00:00: Balancing the network:

              Trial  1: relative flow change = 10.124589
              Trial  2: relative flow change = 1.170853
              Trial  3: relative flow change = 1.161766
              Trial  4: relative flow change = 1.124854
              Trial  5: relative flow change = 0.990238
              Trial  6: relative flow change = 0.644312
              Trial  7: relative flow change = 0.226544
              Trial  8: relative flow change = 0.048396
              Trial  9: relative flow change = 0.002497
              Trial 10: relative flow change = 0.000007
                        maximum  flow change = 0.0000 for Link PBJ
                        maximum  head error  = 0.0000 for Link PBJ

     0:00:00: Balanced after 10 trials
     0:00:00: Reservoir A is emptying
     0:00:00: Reservoir B is emptying
     0:00:00: Reservoir C is filling
   
   
  Node Results:
  ----------------------------------------------
                     Demand      Head  Pressure
  Node                  L/s         m         m
  ----------------------------------------------
  NodeA                0.00    100.00    100.00
  NodeB                0.00     80.00     80.00
  NodeC                0.00     60.00     60.00
  J                    0.00     79.63    -30.37
  A                   -2.35    100.00     -0.00  Reservoir
  B                   -0.29     80.00      0.00  Reservoir
  C                    2.64     60.00     -0.00  Reservoir
   
   
  Link Results:
  ----------------------------------------------
                       Flow  Velocity  Headloss
  Link                  L/s       m/s    /1000m
  ----------------------------------------------
  PAJ                  2.35      0.00     22.63
  PBJ                  0.29      0.00      0.46
  PJC                  2.64      0.00     28.04
  4                    2.35      0.00      0.14
  5                    0.29      0.00      0.00
  6                   -2.64      0.00      0.18
   
  Analysis ended Sat Jul 29 08:57:04 2023
</pre></div>
</div>
</div>
</div>
<p>Nice!  Seems like we have kind of got the hang of the Toolkit.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In class we will draw the actual network simulated above - notice the three extra links, we put these there intentionally (check the video), to be able to interpret pressures at Nodes A,B,C, and J.  In the above example, Nodes A,B, and C are all at zero elevation. Node J is at 110 - so any flow towards J must be uphill.  Lets use the toolbox to help us find the elevation Node J would need to be, to have a pressure of +1 meters.</p>
<p>First lets manipulate Node J elevation to produce a pressure of 0.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>  <span class="c1"># import the package</span>
<span class="c1">#Open the EPANET toolkit &amp; hydraulics solver   </span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex3-tk/EX3-tk.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex3-tk/EX3-tk.rpt&quot;</span><span class="p">)</span> <span class="c1"># The modified file</span>
<span class="c1"># build report command strings Keyword  Action see user manual</span>
<span class="c1">#command0 = &quot;Status     Yes&quot;</span>
<span class="c1">#command1 = &quot;Summary            	Yes&quot;</span>
<span class="c1">#command2 = &quot;Nodes            	ALL&quot;</span>
<span class="c1">#command3 = &quot;Links            	ALL&quot;</span>
<span class="c1">#em.ENsetstatusreport(2) # full status report</span>
<span class="c1">#em.ENsetreport(command0)</span>
<span class="c1">#em.ENsetreport(command1)</span>
<span class="c1">#em.ENsetreport(command2)</span>
<span class="c1">#em.ENsetreport(command3)</span>
<span class="c1">#em.ENsaveinpfile(&quot;./ex3-tk/EX3-tk.inp&quot;) #overwrite the input file</span>
<span class="c1">#em.ENclose()</span>
<span class="c1"># now run from the new file</span>
<span class="c1">#em.ENopen(&quot;./ex3-tk/EX3-tk.inp&quot;, &quot;./ex3-tk/EX3-tk.rpt&quot;)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
<span class="n">nodej</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodeindex</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">)</span> <span class="c1"># Get the index of Node J in the internal database</span>
<span class="n">elevj</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># wrap this into a little search loop</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">elevj</span><span class="p">)</span> <span class="c1"># set nodej to elevation (code 0) of 100.0</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
<span class="n">presj</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial Values&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elevation J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">elevj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; Pressure J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">presj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="p">)</span>
<span class="c1"># Lets do a crude search</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">presj</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tolerance met&quot;</span><span class="p">,</span><span class="nb">iter</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="n">presj</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">:</span>
        <span class="n">elevj</span> <span class="o">=</span> <span class="n">elevj</span><span class="o">*</span><span class="mf">0.99</span>
    <span class="k">if</span> <span class="n">presj</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">:</span>
        <span class="n">elevj</span> <span class="o">=</span> <span class="n">elevj</span><span class="o">*</span><span class="mf">1.01</span>
    <span class="n">em</span><span class="o">.</span><span class="n">ENsetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">elevj</span><span class="p">)</span> <span class="c1"># set nodej to elevation (code 0) of 100.0 </span>
    <span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
    <span class="n">presj</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elevation J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">elevj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; Pressure J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">presj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="p">)</span>
<span class="c1"># end search</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span> <span class="c1"># need to save to a binary file before write</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span> <span class="c1"># now write report</span>
<span class="c1"># Close hydraulics solver &amp; toolkit */</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial Values
Elevation J: 110.0 Pressure J: -30.371
tolerance met 62
Elevation J: 79.628 Pressure J: 0.0
</pre></div>
</div>
</div>
</div>
<p>Now we modify for the target pressure, supplied as a variable - obviously searching as illustrated is terribly inefficient, but does illustrate the utility of the toolkit.  We are using the computer to make adjustments and test outputs rather than doing it ourselves using the GUI; for a complex problem, its far faster to do such exercises programmatically rather then trial-and-error in a GUI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>  <span class="c1"># import the package</span>
<span class="c1">#Open the EPANET toolkit &amp; hydraulics solver   </span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex3-tk/EX3-tk.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex3-tk/EX3-tk.rpt&quot;</span><span class="p">)</span> <span class="c1"># The modified file</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
<span class="n">nodej</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodeindex</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">)</span> <span class="c1"># Get the index of Node J in the internal database</span>
<span class="n">elevj</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># wrap this into a little search loop</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">elevj</span><span class="p">)</span> <span class="c1"># set nodej to elevation (code 0) of 100.0</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
<span class="n">presj</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial Values&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elevation J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">elevj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; Pressure J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">presj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="p">)</span>
<span class="c1"># Lets do a crude search</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">targetp</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">presj</span><span class="o">-</span><span class="n">targetp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tolerance met&quot;</span><span class="p">,</span><span class="nb">iter</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="n">presj</span> <span class="o">&lt;</span> <span class="n">targetp</span> <span class="p">:</span>
        <span class="n">elevj</span> <span class="o">=</span> <span class="n">elevj</span><span class="o">*</span><span class="mf">0.99</span>
    <span class="k">if</span> <span class="n">presj</span> <span class="o">&gt;</span> <span class="n">targetp</span> <span class="p">:</span>
        <span class="n">elevj</span> <span class="o">=</span> <span class="n">elevj</span><span class="o">*</span><span class="mf">1.11</span>
    <span class="n">em</span><span class="o">.</span><span class="n">ENsetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">elevj</span><span class="p">)</span> <span class="c1"># set nodej to elevation (code 0) of 100.0 </span>
    <span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
    <span class="n">presj</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">nodej</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">iter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Elevation J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">elevj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; Pressure J: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">presj</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="p">)</span>
<span class="c1"># end search</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span> <span class="c1"># need to save to a binary file before write</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span> <span class="c1"># now write report</span>
<span class="c1"># Close hydraulics solver &amp; toolkit */</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial Values
Elevation J: 110.0 Pressure J: -30.371
tolerance met 318
318 Elevation J: 78.628 Pressure J: 1.0
</pre></div>
</div>
</div>
</div>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Link to this heading">#</a></h3>
<p>A better way for the example above would be some version of bisection. Modify the script to search for the desired elevation using bisection; select a reasonable tolerance to stop.  You may find Chat-GPT 4.0 useful to construct a working script.</p>
<p>A bisection solver could be adapted from <a class="reference external" href="http://54.243.252.9/ce-4353-webroot/ce4353jb/ce4353workbook/_build/html/lessons/specificenergy/specificenergy1.html">Cleveland, T.G. (2022) Hydraulic System Design JupyterBook notes to accompany CE 4353/CE 5360 at TTU; Example 1 in specific energy section</a></p>
</section>
</section>
<section id="example-4-a-simple-looped-network">
<h2>Example 4 - A simple looped network<a class="headerlink" href="#example-4-a-simple-looped-network" title="Link to this heading">#</a></h2>
<p>Expanding the examples, we will next consider a looped network. As before we will use an exercise as the motivating example.</p>
<p><strong>Problem Statement</strong></p>
<blockquote>
<div><p>The water-supply network shown in Figure 61 has constant-head elevated storage tanks at A and C, with inflow and outflow at B and D. <img alt="" src="http://freeswmm.ddns.net/ects-epanet/ects-epanet-notes/lessons/lesson02/ex4/ex4.png" /> The network is on flat terrain with node elevations all equal to 50 meters. If all pipes are ductile iron, compute the inflows/outflows to the storage tanks. Assume that
flow in all pipes are fully turbulent.</p>
</div></blockquote>
<p>As before we will use the previously prepared input file and modify to explore the Toolkit.  By this point its legitimately a lot of cut and paste.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>  <span class="c1"># import the package</span>
<span class="c1">#Open the EPANET toolkit &amp; hydraulics solver   </span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex4-tk/EX4-JB.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex4-tk/EX4-tk.rpt&quot;</span><span class="p">)</span>
<span class="c1"># build report command strings Keyword  Action see user manual</span>
<span class="n">command0</span> <span class="o">=</span> <span class="s2">&quot;Status     Yes&quot;</span>
<span class="n">command1</span> <span class="o">=</span> <span class="s2">&quot;Summary            	Yes&quot;</span>
<span class="n">command2</span> <span class="o">=</span> <span class="s2">&quot;Nodes            	ALL&quot;</span>
<span class="n">command3</span> <span class="o">=</span> <span class="s2">&quot;Links            	ALL&quot;</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetstatusreport</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># full status report</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">command0</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">command1</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">command3</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveinpfile</span><span class="p">(</span><span class="s2">&quot;./ex4-tk/EX4-tk.inp&quot;</span><span class="p">)</span> <span class="c1">#overwrite the input file</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
<span class="c1"># now run from the new file</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex4-tk/EX4-tk.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex4-tk/EX4-tk.rpt&quot;</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span> <span class="c1"># need to save to a binary file before write</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span> <span class="c1"># now write report</span>
<span class="c1"># Close hydraulics solver &amp; toolkit */</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>

<span class="o">!</span><span class="w"> </span>cat<span class="w"> </span>./ex4-tk/EX4-tk.rpt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Page 1                                    Sat Jul 29 10:32:27 2023

  ******************************************************************
  *                           E P A N E T                          *
  *                   Hydraulic and Water Quality                  *
  *                   Analysis for Pipe Networks                   *
  *                         Version 2.2                            *
  ******************************************************************
  
   
      Input Data File ................... ./ex4-tk/EX4-tk.inp
      Number of Junctions................ 4
      Number of Reservoirs............... 2
      Number of Tanks ................... 0
      Number of Pipes ................... 6
      Number of Pumps ................... 0
      Number of Valves .................. 0
      Headloss Formula .................. Darcy-Weisbach
      Nodal Demand Model ................ DDA
      Hydraulic Timestep ................ 1.00 hrs
      Hydraulic Accuracy ................ 0.001000
      Status Check Frequency ............ 2
      Maximum Trials Checked ............ 10
      Damping Limit Threshold ........... 0.000000
      Maximum Trials .................... 40
      Quality Analysis .................. None
      Specific Gravity .................. 1.00
      Relative Kinematic Viscosity ...... 1.00
      Relative Chemical Diffusivity ..... 1.00
      Demand Multiplier ................. 1.00
      Total Duration .................... 0.00 hrs
      Reporting Criteria:
         All Nodes
         All Links
   
  Analysis begun Sat Jul 29 10:32:27 2023

   
  Hydraulic Status:
  -----------------------------------------------------------------------
     0:00:00: Balanced after 5 trials
     0:00:00: Reservoir 1 is emptying
     0:00:00: Reservoir 2 is filling
   
   
  Node Results:
  ----------------------------------------------
                     Demand      Head  Pressure
  Node                  L/s         m         m
  ----------------------------------------------
  3                    0.00     75.00     25.00
  4                 -200.00     79.97     29.97
  5                    0.00     70.00     20.00
  6                  200.00     69.90     19.90
  1                 -121.21     75.00     -0.00  Reservoir
  2                  121.21     70.00      0.00  Reservoir
   
   
  Link Results:
  ----------------------------------------------
                       Flow  Velocity  Headloss
  Link                  L/s       m/s    /1000m
  ----------------------------------------------
  1                  121.21      0.19      0.04
  2                 -121.21      0.19      0.04
  3                  -63.45      1.29      7.10
  4                  136.55      1.93     12.47
  5                   15.34      0.16      0.09
  6                  184.66      1.47      5.10
   
  Analysis ended Sat Jul 29 10:32:27 2023
</pre></div>
</div>
</div>
</div>
<p>Now lets use some of the tools to get more than one thing.  First we will get the count of some objects, then we will change the diameter of one pipe and examine the effect.  Notice how we can repeatedly change things and rerun the hydraulic module (as above) almost without effort using the Toolkit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#ENgetcount(countcode)</span>

<span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>  <span class="c1"># import the package</span>
<span class="c1">#Open the EPANET toolkit &amp; hydraulics solver   </span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;./ex4-tk/EX4-tk.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex4-tk/EX4-tk.rpt&quot;</span><span class="p">)</span>
<span class="n">howmanynodes</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetcount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Code 0 == nodes</span>
<span class="n">howmanylinks</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetcount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Code 2 == links</span>
<span class="n">howmanyFGN</span>   <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">ENgetcount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Code 1 == Tanks/Reservoirs</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; System Topology is:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Node count: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">howmanynodes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Link count: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">howmanylinks</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; FGN count : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">howmanyFGN</span><span class="p">))</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># create empty list</span>
<span class="k">for</span> <span class="n">ilink</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">howmanylinks</span><span class="p">):</span>
    <span class="n">diameter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">em</span><span class="o">.</span><span class="n">ENgetlinkvalue</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># Code 0 == diameter</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Link :&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Diameter(mm) : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">diameter</span><span class="p">[</span><span class="n">ilink</span><span class="p">]))</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
<span class="n">hloss</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># create empty list</span>
<span class="k">for</span> <span class="n">ilink</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">howmanylinks</span><span class="p">):</span>
    <span class="n">hloss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">em</span><span class="o">.</span><span class="n">ENgetlinkvalue</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># Code 10 == head loss</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Link :&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Head loss (m/1000m) : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">hloss</span><span class="p">[</span><span class="n">ilink</span><span class="p">],</span><span class="mi">4</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Change diameter link 4&quot;</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsetlinkvalue</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># create empty list</span>
<span class="k">for</span> <span class="n">ilink</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">howmanylinks</span><span class="p">):</span>
    <span class="n">diameter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">em</span><span class="o">.</span><span class="n">ENgetlinkvalue</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># Code 0 == diameter</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Link :&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Diameter(mm) : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">diameter</span><span class="p">[</span><span class="n">ilink</span><span class="p">]))</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
<span class="n">nhloss</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># create empty list</span>
<span class="k">for</span> <span class="n">ilink</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">howmanylinks</span><span class="p">):</span>
    <span class="n">nhloss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">em</span><span class="o">.</span><span class="n">ENgetlinkvalue</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># Code 10 == head loss</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Link :&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ilink</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Head loss (m/1000m) : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nhloss</span><span class="p">[</span><span class="n">ilink</span><span class="p">],</span><span class="mi">4</span><span class="p">)))</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span> <span class="c1"># need to save to a binary file before write</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span> <span class="c1"># now write report</span>
<span class="c1"># Close hydraulics solver &amp; toolkit */</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> System Topology is:

 Node count: 6
 Link count: 6
 FGN count : 2
Link :1 Diameter(mm) : 900.0
Link :2 Diameter(mm) : 900.0
Link :3 Diameter(mm) : 250.0
Link :4 Diameter(mm) : 300.0
Link :5 Diameter(mm) : 350.0
Link :6 Diameter(mm) : 400.0
Link :1 Head loss (m/1000m) : 0.0004
Link :2 Head loss (m/1000m) : 0.0004
Link :3 Head loss (m/1000m) : 4.973
Link :4 Head loss (m/1000m) : 9.9723
Link :5 Head loss (m/1000m) : 0.1026
Link :6 Head loss (m/1000m) : 5.1018
Change diameter link 4
Link :1 Diameter(mm) : 900.0
Link :2 Diameter(mm) : 900.0
Link :3 Diameter(mm) : 250.0
Link :4 Diameter(mm) : 100.0
Link :5 Diameter(mm) : 350.0
Link :6 Diameter(mm) : 400.0
Link :1 Head loss (m/1000m) : 0.0
Link :2 Head loss (m/1000m) : 0.0
Link :3 Head loss (m/1000m) : 40.4552
Link :4 Head loss (m/1000m) : 45.4552
Link :5 Head loss (m/1000m) : 0.1024
Link :6 Head loss (m/1000m) : 5.1024
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Exercise<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Change the parameter code to recover flow instead of head loss and rerun the example, what effect does shrinking pipe 4 have on flow rate?</p>
</section>
</section>
<section id="example-5-simulating-a-pump">
<h2>Example 5 - Simulating a Pump<a class="headerlink" href="#example-5-simulating-a-pump" title="Link to this heading">#</a></h2>
<p>This example repeats the same problem as before, but using the Toolkit to load and run the model.  A bit of the earlier example is replicated below:</p>
<blockquote>
<div><p>Figure XX is a conceptual model of a pump lifting water through a 100 mm diameter, 100 meter long, ductile iron pipe from a lower elevation reservoir to an upper reservoir. <br><br><img alt="" src="http://freeswmm.ddns.net/ects-epanet/ects-epanet-notes/lessons/lesson02/ex5/P2-39.png" /><br><br>The suction side of the pump is a 100 mm diameter, 4-meter long ductile iron pipe. The difference in reservoir free-surface elevations is 10 meters. <br><br>The pump performance curve is given
as
$<span class="math notranslate nohighlight">\(hp = 15.0-0.1Q^2 \)</span>$
where the added head is in meters and the flow rate is in liters per second (lps).
The analysis goal is to estimate the flow rate in the system.</p>
</div></blockquote>
<p>To use the Toolkit we more or less just repeat from the above examples, here I run the entire simulation as some adjustments are left as exercises.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>  <span class="c1"># import the package</span>
<span class="c1"># Run a complete simulation. input file must already exist</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENepanet</span><span class="p">(</span><span class="s2">&quot;./ex5-tk/EX5-tk.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;./ex5-tk/EX5-tk.rpt&quot;</span><span class="p">)</span> 
<span class="c1"># Print the output report (it will be sparse)</span>
<span class="o">!</span>cat<span class="w"> </span>./ex5-tk/EX5-tk.rpt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Page 1                                    Sun Jul 30 15:32:30 2023

  ******************************************************************
  *                           E P A N E T                          *
  *                   Hydraulic and Water Quality                  *
  *                   Analysis for Pipe Networks                   *
  *                         Version 2.2                            *
  ******************************************************************
  
  Analysis begun Sun Jul 30 15:32:30 2023

  Analysis ended Sun Jul 30 15:32:30 2023
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h2>Exercise<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>Use the Toolkit to modify the input file (EX5-tk) to produce a more useful output file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># one possible solution
import epamodule as em  # import the package
#Open the EPANET toolkit &amp; hydraulics solver   
em.ENopen(&quot;./ex5-tk/EX5-tk.inp&quot;, &quot;./ex5-tk/EX5-tk.rpt&quot;)
# build report command strings Keyword  Action see user manual
command0 = &quot;Status     Yes&quot;
command1 = &quot;Summary            	Yes&quot;
command2 = &quot;Nodes            	ALL&quot;
command3 = &quot;Links            	ALL&quot;
em.ENsetstatusreport(2) # full status report
em.ENsetreport(command0)
em.ENsetreport(command1)
em.ENsetreport(command2)
em.ENsetreport(command3)
em.ENsaveinpfile(&quot;./ex5-tk/EX5-tkmod.inp&quot;) #overwrite the input file
em.ENclose()
# now run from the new file
em.ENepanet(&quot;./ex5-tk/EX5-tkmod.inp&quot;, &quot;./ex5-tk/EX5-tkmod.rpt&quot;)
! cat ./ex5-tk/EX5-tkmod.rpt
</pre></div>
</div>
</section>
<section id="id3">
<h2>Exercise<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>Modify the upstream pool elevation so it is at 14.999 meters.  The pump flowrate should go down a lot (but not to zero).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># one possible solution
import epamodule as em  # import the package
#Open the EPANET toolkit &amp; hydraulics solver   
em.ENopen(&quot;./ex5-tk/EX5-tkmod.inp&quot;, &quot;./ex5-tk/EX5-tkmod.rpt&quot;)
# The upper reservoir is Node 2 in the input file
nodej = em.ENgetnodeindex(&quot;2&quot;) # Get the index of Node 2 in the internal database
elevj = em.ENgetnodevalue(nodej,0) # Get the elevation and check
print(&quot;Internal Node: &quot;,nodej,&quot; Initial Head: &quot;,round(elevj,3))
elevj=24.9999 # Change so thet DeltaH is 14.999
print(&quot;Increase Head to &quot;, round(elevj,3))
em.ENsetnodevalue(nodej,0,elevj)
em.ENsaveinpfile(&quot;./ex5-tk/EX5-tkmod.inp&quot;) #overwrite the input file
em.ENclose()
# now run from the new file
em.ENepanet(&quot;./ex5-tk/EX5-tkmod.inp&quot;, &quot;./ex5-tk/EX5-tkmod.rpt&quot;)
! cat ./ex5-tk/EX5-tkmod.rpt
</pre></div>
</div>
</section>
<section id="id4">
<h2>Exercise<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>Now modify the pump curve to approximately recover the flowrate.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>At the time of writing, pump curves are edited outside of the Toolkit - you would search the input file for the section</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">CURVES</span><span class="p">]</span>
<span class="p">;</span><span class="n">ID</span>              	<span class="n">X</span><span class="o">-</span><span class="n">Value</span>     	<span class="n">Y</span><span class="o">-</span><span class="n">Value</span>
<span class="p">;</span><span class="n">PUMP</span><span class="p">:</span> 
 <span class="mi">1</span>               	<span class="mi">0</span>           	<span class="mi">15</span>          
 <span class="mi">1</span>               	<span class="mi">1</span>           	<span class="mf">14.9</span>        
 <span class="mi">1</span>               	<span class="mi">10</span>          	<span class="mi">5</span>   
</pre></div>
</div>
<p>Then edit the indicated curve - for this exercise, manual edits would be OK.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Probably just do this in class and leave the file on the server</p>
</div>
</section>
<section id="files">
<h2>Files<a class="headerlink" href="#files" title="Link to this heading">#</a></h2>
<p>The files used in the above examples are located at:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="http://freeswmm.ddns.net/ects-epanet/ects-epanet-notes/lessons/lesson03/ex3-tk/">Example 3 Files</a></p></li>
<li><p><a class="reference external" href="http://freeswmm.ddns.net/ects-epanet/ects-epanet-notes/lessons/lesson03/ex4-tk/">Example 4 Files</a></p></li>
<li><p><a class="reference external" href="http://freeswmm.ddns.net/ects-epanet/ects-epanet-notes/lessons/lesson03/ex5-tk/">Example 5 Files</a></p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lessons/lesson03"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="epanet-rulesGUI.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">3.2 EPANET (Examples 1 and 2) using the Toolkit</p>
      </div>
    </a>
    <a class="right-next"
       href="epanet-rulesAPI.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">3.4 EPANET Control Rules using the Toolkit</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose">Purpose</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-notes">Installation Notes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-3-three-reservoir-problem">Example 3 : Three-Reservoir-Problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-4-a-simple-looped-network">Example 4 - A simple looped network</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-5-simulating-a-pump">Example 5 - Simulating a Pump</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#files">Files</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Theodore G. Cleveland, Ph.D., P.E., M.ASCE, F.EWRI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>