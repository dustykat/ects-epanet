
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3 EPANET Programmers Toolkit &#8212; Hydraulic Network Simulation with EPANET and Python</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.2 EPANET example using" href="epanet-rulesGUI.html" />
    <link rel="prev" title="2.5 EPANET Control Rules" href="../lesson02/epanet-rules.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Hydraulic Network Simulation with EPANET and Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   About this book
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lesson01/introduction.html">
   1 Hydraulic Networks and Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson01/hydraulic-networks.html">
     1.2 Network Hydraulics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson01/pythonjupyter.html">
     1.3 Python/Jupyter Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson01/pythonhydraulics.html">
     1.4 Hydraulics in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson01/pythonhydraulicsmodule.html">
     1.5 The
     <code class="docutils literal notranslate">
      <span class="pre">
       pipenet
      </span>
     </code>
     module
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson01/pythonpumpingmodule.html">
     1.6 Pumps
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lesson02/epanet-classic.html">
   2 EPANET Intro/Examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson02/epanet-gui.html">
     2.2 EPANET GUI Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson02/epanet-eps.html">
     2.3 Extended period simulation (EPS)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson02/epanet-watq.html">
     2.4 Water Quality Simulation in EPANET
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson02/epanet-rules.html">
     2.5 EPANET Control Rules
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="current reference internal" href="#">
   3 EPANET Programmers Toolkit
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="epanet-rulesGUI.html">
     3.2 EPANET example using
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="epanet-rulesCLI.html">
     3.3 EPANET example using the Toolkit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="epanet-rulesAPI.html">
     3.4 EPANET example using the Toolkit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="epanet-sensors.html">
     3.5 EPANET Sensors integration
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lesson04/epanet-future-CandC1.html">
   4 Command and Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson04/epanet-future-CandC2.html">
     4.2 CandC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson04/epanet-future-CandC3.html">
     4.X Build Notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson04/epanet-future.html">
     4.4 Unsolved Problems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lesson04/epanet-exam.html">
     4.5 EPANET Exam
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/lessons/lesson03/epanet-toolkit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flessons/lesson03/epanet-toolkit.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/lessons/lesson03/epanet-toolkit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#purpose">
   Purpose
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installing-on-a-raspberry-pi">
   Installing on a Raspberry Pi
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="epanet-programmers-toolkit">
<h1>3 EPANET Programmers Toolkit<a class="headerlink" href="#epanet-programmers-toolkit" title="Permalink to this headline">¶</a></h1>
<p>The EPANET Programmer’s Toolkit is a software applications programming interface (API) designed to facilitate the analysis and simulation of water distribution networks. Developed by the United States Environmental Protection Agency (EPA), EPANET is widely recognized as a comprehensive and reliable hydraulic and water quality modeling tool. The EPANET Programmer’s Toolkit offers engineers and researchers the ability to harness the full potential of EPANET’s capabilities, providing a platform for advanced water network analysis and optimization, directly accessing the computation engine without requiring the Graphical User Interface (GUI), or running the program in a batch mode with a prebuilt input file.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The EPANET Programmer’s Toolkit provides essential functions that allow users to manipulate EPANET models and retrieve critical information for hydraulic and water quality analysis. With the toolkit, users can access network data such as pipe and node properties, demand patterns, and control settings. This information can be modified or updated programmatically, enabling engineers to conduct what-if scenarios, optimize system design, and assess the impact of various operational strategies on network performance.</p>
<p>One of the toolkit’s key features is its ability to perform hydraulic and water quality simulations. Users can dynamically simulate water flow and pressure behavior in the network, enabling accurate prediction of system performance under different operating conditions. Moreover, the toolkit allows for the analysis of water quality parameters, such as chlorine concentration and contaminant transport, aiding in the evaluation of water safety and compliance with regulatory standards.</p>
<p>The EPANET Programmer’s Toolkit empowers water industry professionals to tackle complex water network challenges with greater efficiency and accuracy. By leveraging its capabilities, engineers can optimize pipe sizing, evaluate system resilience, and assess the impact of infrastructure changes on network performance. The toolkit’s ability to perform advanced simulations and analysis aids in the identification of potential issues, facilitating proactive decision-making and improving overall water network management. Furthermore, the EPANET Programmer’s Toolkit plays a crucial role in supporting research and innovation in the field of water distribution system analysis, fostering the development of new methodologies and solutions to address emerging challenges in water management.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>link to EPANET toolkit description here :::</p>
</div>
</div>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>The primary purpose of the EPANET Programmer’s Toolkit is to enhance the functionality of EPANET and enable users to access its full potential in water distribution network analysis. The Toolkit serves as an <strong>interface</strong> that allows engineers and researchers to programmatically access and manipulate EPANET models, retrieve critical information, and perform hydraulic and water quality simulations without having to access the model through the Graphical User Interface (GUI). By providing essential modeling access functions, integration capabilities, and customization options, the toolkit enables analysts to conduct in-depth analysis, optimize system design, and evaluate the performance of water networks under various operational conditions.</p>
<p>The EPANET Programmer’s Toolkit supports integration with various programming languages, including C, C++, and Python, making it end-user adaptable to different software development environments. This flexibility allows engineers and researchers to leverage their preferred programming languages and frameworks, facilitating seamless integration with existing tools and workflows. Additionally, the toolkit’s extensive Application Programming Interface (API) documentation and code examples provide valuable resources for developers, enabling them to extend EPANET’s functionality and customize the software to meet specific project requirements.</p>
</div>
<div class="section" id="installing-on-a-raspberry-pi">
<h2>Installing on a Raspberry Pi<a class="headerlink" href="#installing-on-a-raspberry-pi" title="Permalink to this headline">¶</a></h2>
<p>This section is specific to my development computer - the process is:</p>
<ol class="simple">
<li><p>Download and build a shared object library.</p></li>
<li><p>Copy the library (or path to the lobrary) into a working directory where you intend to access the library</p></li>
<li><p>Write and run your scripts</p></li>
</ol>
<p>Now being lazy here are some scripts to perform the tasks automatically</p>
<p>First make a directory to store the toolkit: (note use of magic function to execute a system command)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%mkdir en2toolkit</span>
</pre></div>
</div>
</div>
</div>
<p>Next change into our new directory</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%cd en2toolkit </span>
</pre></div>
</div>
</div>
</div>
<p>Now clone from the GitHub repository (that completes the first half of step 1 above)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#! git clone https://github.com/OpenWaterAnalytics/EPANET.git  #clone the remote into the directory</span>
</pre></div>
</div>
</div>
</div>
<p>From here need to work as superuser, easiest to open a shell and complete the build there.  First open the shell and change into the working directory as a superuser (below I switched to the root user because my regular user cannot issue superuser commands).  Then issue the <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span></code> directive to compile the objects for linking into the package.  After that completes then issue the <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--build</span> <span class="pre">.</span> <span class="pre">--config</span> <span class="pre">Release</span></code> directive and let it run to (hopefully successful) completion.</p>
<p><img alt="" src="../../_images/buildtools1of2.png" /></p>
<p>After that completes then the library is found in the <code class="docutils literal notranslate"><span class="pre">\lib</span></code> directory.  Simply copy it into the work directory where you want to model.  A symbolic link added into the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable is another way to proceede.</p>
<p><img alt="" src="../../_images/buildtools2of2.png" /></p>
<p>Now to test the build of the shared object modules.  Import the interface module (listing below) which is stored as a file in our workspace.</p>
<p><span class="xref myst">epamodule.py (from OWA GitHub)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epamodule</span> <span class="k">as</span> <span class="nn">em</span>
</pre></div>
</div>
</div>
</div>
<p>Then run an example</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">em</span><span class="o">.</span><span class="n">ENepanet</span><span class="p">(</span><span class="s2">&quot;Net1.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;Net1.rpt&quot;</span><span class="p">)</span> <span class="c1"># runs a complete simulation. input file must exist and have contents.</span>
</pre></div>
</div>
</div>
</div>
<p>Now same example but more granular control.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Open the EPANET toolkit &amp; hydraulics solver   </span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="s2">&quot;Net1g.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;Net1g.rpt&quot;</span><span class="p">)</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span> <span class="c1"># need to save to a binary file before write</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span> <span class="c1"># now write report</span>
<span class="c1"># Close hydraulics solver &amp; toolkit */</span>
<span class="n">em</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>put the epanet-by-examples here access via toolkit</p>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>None, will go through install in next module.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://pypi.org/project/EPANETTOOLS/">EPANETTOOLS1.0.0 (A pypi.org package) </a></p>
<p><span class="xref myst"></span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Python EpanetToolkit interface</span>

<span class="sd">added function ENsimtime&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">_plat</span><span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
<span class="k">if</span> <span class="n">_plat</span><span class="o">==</span><span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
  <span class="n">_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">&quot;./libepanet2.so&quot;</span><span class="p">)</span>
<span class="c1">##  _lib = ctypes.CDLL(&quot;./en2tools.so.1.5.0&quot;)</span>
<span class="c1">##  _lib = ctypes.CDLL(&quot;./epanet2toolkit.so&quot;)</span>
<span class="k">elif</span> <span class="n">_plat</span><span class="o">==</span><span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="c1"># if epanet2.dll compiled with __cdecl (as in OpenWaterAnalytics)</span>
    <span class="n">_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">&quot;epamodule\epanet2.dll&quot;</span><span class="p">)</span>
    <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetversion</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()))</span>
  <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
     <span class="c1"># if epanet2.dll compiled with __stdcall (as in EPA original DLL)</span>
     <span class="k">try</span><span class="p">:</span>
       <span class="n">_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">epanet2</span>
       <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetversion</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()))</span>
     <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
       <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;epanet2.dll not suitable&quot;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
  <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Platform &#39;</span><span class="o">+</span> <span class="n">_plat</span> <span class="o">+</span><span class="s1">&#39; unsupported (not yet)&#39;</span><span class="p">)</span>


<span class="n">_current_simulation_time</span><span class="o">=</span>  <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>

<span class="n">_max_label_len</span><span class="o">=</span> <span class="mi">32</span>
<span class="n">_err_max_char</span><span class="o">=</span> <span class="mi">80</span>





<span class="k">def</span> <span class="nf">ENepanet</span><span class="p">(</span><span class="n">nomeinp</span><span class="p">,</span> <span class="n">nomerpt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nomebin</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs a complete EPANET simulation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    nomeinp: name of the input file</span>
<span class="sd">    nomerpt: name of an output report file</span>
<span class="sd">    nomebin: name of an optional binary output file</span>
<span class="sd">    vfunc  : pointer to a user-supplied function which accepts a character string as its argument.&quot;&quot;&quot;</span>  
    <span class="k">if</span> <span class="n">vfunc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">CFUNC</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CFUNCTYPE</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">)</span>
        <span class="n">callback</span><span class="o">=</span> <span class="n">CFUNC</span><span class="p">(</span><span class="n">vfunc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">callback</span><span class="o">=</span> <span class="kc">None</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENepanet</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomeinp</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                        <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomerpt</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                        <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomebin</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                        <span class="n">callback</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENopen</span><span class="p">(</span><span class="n">nomeinp</span><span class="p">,</span> <span class="n">nomerpt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nomebin</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Opens the Toolkit to analyze a particular distribution system</span>

<span class="sd">    Arguments:</span>
<span class="sd">    nomeinp: name of the input file</span>
<span class="sd">    nomerpt: name of an output report file</span>
<span class="sd">    nomebin: name of an optional binary output file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomeinp</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomerpt</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomebin</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> 
      <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENclose</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Closes down the Toolkit system (including all files being processed)&quot;&quot;&quot;</span>
  <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENgetnodeindex</span><span class="p">(</span><span class="n">nodeid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the index of a node with a specified ID.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    nodeid: node ID label&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodeindex</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nodeid</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetnodeid</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the ID label of a node with a specified index.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: node index&quot;&quot;&quot;</span>    
    <span class="n">label</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodeid</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENsettitle</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span><span class="n">line2</span><span class="p">,</span><span class="n">line3</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Set inp file title</span>
<span class="sd">	</span>
<span class="sd">	Arguments:</span>
<span class="sd">	line1: line 1 of 3 inp title lines</span>
<span class="sd">	line2: line 2 of 3 inp title lines</span>
<span class="sd">	line3: line 3 of 3 inp title lines&quot;&quot;&quot;</span>
	<span class="n">ierr</span> <span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsettitle</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
			       <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line2</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
			       <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line3</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
	<span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetflowunits</span><span class="p">(</span><span class="n">units_code</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set flow units</span>

<span class="sd">    Arguments:</span>
<span class="sd">    units_code:	int code for unit type:</span>
<span class="sd">        EN_CFS	0	cubic feet per second</span>
<span class="sd">        EN_GPM	1	gallons per minute</span>
<span class="sd">        EN_MGD	2	million gallons per day</span>
<span class="sd">        EN_IMGD	3	Imperial mgd</span>
<span class="sd">        EN_AFD	4	acre-feet per day</span>
<span class="sd">        EN_LPS	5	liters per second</span>
<span class="sd">        EN_LPM	6	liters per minute</span>
<span class="sd">        EN_MLD	7	million liters per day</span>
<span class="sd">        EN_CMH	8	cubic meters per hour</span>
<span class="sd">        EN_CMD	9	cubic meters per day</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ierr</span> <span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetflowunits</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">units_code</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENgetnodetype</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the node-type code for a specific node.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: node index&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodetype</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetnodevalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a specific node parameter.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:     node index</span>
<span class="sd">    paramcode: Node parameter codes consist of the following constants:</span>
<span class="sd">                  EN_ELEVATION  Elevation</span>
<span class="sd">                  EN_BASEDEMAND ** Base demand</span>
<span class="sd">                  EN_PATTERN    ** Demand pattern index</span>
<span class="sd">                  EN_EMITTER    Emitter coeff.</span>
<span class="sd">                  EN_INITQUAL   Initial quality</span>
<span class="sd">                  EN_SOURCEQUAL Source quality</span>
<span class="sd">                  EN_SOURCEPAT  Source pattern index</span>
<span class="sd">                  EN_SOURCETYPE Source type (See note below)</span>
<span class="sd">                  EN_TANKLEVEL  Initial water level in tank</span>
<span class="sd">                  EN_DEMAND     * Actual demand</span>
<span class="sd">                  EN_HEAD       * Hydraulic head</span>
<span class="sd">                  EN_PRESSURE   * Pressure</span>
<span class="sd">                  EN_QUALITY    * Actual quality</span>
<span class="sd">                  EN_SOURCEMASS * Mass flow rate per minute of a chemical source</span>
<span class="sd">                    * computed values)</span>
<span class="sd">                   ** primary demand category is last on demand list</span>

<span class="sd">               The following parameter codes apply only to storage tank nodes:</span>
<span class="sd">                  EN_INITVOLUME  Initial water volume</span>
<span class="sd">                  EN_MIXMODEL    Mixing model code (see below)</span>
<span class="sd">                  EN_MIXZONEVOL  Inlet/Outlet zone volume in a 2-compartment tank</span>
<span class="sd">                  EN_TANKDIAM    Tank diameter</span>
<span class="sd">                  EN_MINVOLUME   Minimum water volume</span>
<span class="sd">                  EN_VOLCURVE    Index of volume versus depth curve (0 if none assigned)</span>
<span class="sd">                  EN_MINLEVEL    Minimum water level</span>
<span class="sd">                  EN_MAXLEVEL    Maximum water level</span>
<span class="sd">                  EN_MIXFRACTION Fraction of total volume occupied by the inlet/outlet zone in a 2-compartment tank</span>
<span class="sd">                  EN_TANK_KBULK  Bulk reaction rate coefficient&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="c1">##------</span>
<span class="k">def</span> <span class="nf">ENgetlinkindex</span><span class="p">(</span><span class="n">linkid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the index of a link with a specified ID.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    linkid: link ID label&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinkindex</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">linkid</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetlinkid</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the ID label of a link with a specified index.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: link index&quot;&quot;&quot;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinkid</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetlinktype</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the link-type code for a specific link.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: link index&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinktype</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetlinknodes</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the indexes of the end nodes of a specified link.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: link index&quot;&quot;&quot;</span>
    <span class="n">j1</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">j2</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinknodes</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">j2</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENgetlinkvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a specific link parameter.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:     link index</span>
<span class="sd">    paramcode: Link parameter codes consist of the following constants:</span>
<span class="sd">                 EN_DIAMETER     Diameter</span>
<span class="sd">                 EN_LENGTH       Length</span>
<span class="sd">                 EN_ROUGHNESS    Roughness coeff.</span>
<span class="sd">                 EN_MINORLOSS    Minor loss coeff.</span>
<span class="sd">                 EN_INITSTATUS   Initial link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_INITSETTING  Roughness for pipes, initial speed for pumps, initial setting for valves</span>
<span class="sd">                 EN_KBULK        Bulk reaction coeff.</span>
<span class="sd">                 EN_KWALL        Wall reaction coeff.</span>
<span class="sd">                 EN_FLOW         * Flow rate</span>
<span class="sd">                 EN_VELOCITY     * Flow velocity</span>
<span class="sd">                 EN_HEADLOSS     * Head loss</span>
<span class="sd">                 EN_STATUS       * Actual link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_SETTING      * Roughness for pipes, actual speed for pumps, actual setting for valves</span>
<span class="sd">                 EN_ENERGY       * Energy expended in kwatts</span>
<span class="sd">                   * computed values&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinkvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>
<span class="c1">#------</span>

<span class="k">def</span> <span class="nf">ENgetpatternid</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the ID label of a particular time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: pattern index&quot;&quot;&quot;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternid</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENgetpatternindex</span><span class="p">(</span><span class="n">patternid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the index of a particular time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    id: pattern ID label&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternindex</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">patternid</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetpatternlen</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the number of time periods in a specific time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:pattern index&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternlen</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetpatternvalue</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the multiplier factor for a specific time period in a time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:  time pattern index</span>
<span class="sd">    period: period within time pattern&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>



<span class="k">def</span> <span class="nf">ENgetcount</span><span class="p">(</span><span class="n">countcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the number of network components of a specified type.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    countcode: component code EN_NODECOUNT</span>
<span class="sd">                              EN_TANKCOUNT</span>
<span class="sd">                              EN_LINKCOUNT</span>
<span class="sd">                              EN_PATCOUNT</span>
<span class="sd">                              EN_CURVECOUNT</span>
<span class="sd">                              EN_CONTROLCOUNT&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcount</span><span class="p">(</span><span class="n">countcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetflowunits</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Retrieves a code number indicating the units used to express all flow rates.&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetflowunits</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>    


<span class="k">def</span> <span class="nf">ENgettimeparam</span><span class="p">(</span><span class="n">paramcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a specific analysis time parameter.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    paramcode: EN_DURATION     </span>
<span class="sd">               EN_HYDSTEP</span>
<span class="sd">               EN_QUALSTEP</span>
<span class="sd">               EN_PATTERNSTEP</span>
<span class="sd">               EN_PATTERNSTART</span>
<span class="sd">               EN_REPORTSTEP</span>
<span class="sd">               EN_REPORTSTART</span>
<span class="sd">               EN_RULESTEP</span>
<span class="sd">               EN_STATISTIC</span>
<span class="sd">               EN_PERIODS&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgettimeparam</span><span class="p">(</span><span class="n">paramcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span>  <span class="nf">ENgetqualtype</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the type of water quality analysis called for</span>
<span class="sd">    returns  qualcode: Water quality analysis codes are as follows:</span>
<span class="sd">                       EN_NONE	0 No quality analysis</span>
<span class="sd">                       EN_CHEM	1 Chemical analysis</span>
<span class="sd">                       EN_AGE 	2 Water age analysis</span>
<span class="sd">                       EN_TRACE	3 Source tracing</span>
<span class="sd">             tracenode:	index of node traced in a source tracing</span>
<span class="sd">	                analysis  (value will be 0 when qualcode</span>
<span class="sd">			is not EN_TRACE)&quot;&quot;&quot;</span>
    <span class="n">qualcode</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">tracenode</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetqualtype</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">qualcode</span><span class="p">),</span>
                             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">tracenode</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qualcode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tracenode</span><span class="o">.</span><span class="n">value</span>



<span class="c1">#-------Retrieving other network information--------</span>
<span class="k">def</span> <span class="nf">ENgetcontrol</span><span class="p">(</span><span class="n">cindex</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the parameters of a simple control statement.</span>
<span class="sd">    Arguments:</span>
<span class="sd">       cindex:  control statement index</span>
<span class="sd">       ctype:   control type code EN_LOWLEVEL   (Low Level Control)</span>
<span class="sd">                                  EN_HILEVEL    (High Level Control)</span>
<span class="sd">                                  EN_TIMER      (Timer Control)       </span>
<span class="sd">                                  EN_TIMEOFDAY  (Time-of-Day Control)</span>
<span class="sd">       lindex:  index of link being controlled</span>
<span class="sd">       setting: value of the control setting</span>
<span class="sd">       nindex:  index of controlling node</span>
<span class="sd">       level:   value of controlling water level or pressure for level controls </span>
<span class="sd">                or of time of control action (in seconds) for time-based controls&quot;&quot;&quot;</span>
    <span class="c1">#int ENgetcontrol(int cindex, int* ctype, int* lindex, float* setting, int* nindex, float* level )</span>
    <span class="n">ctype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">lindex</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">setting</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">nindex</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>

    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcontrol</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">cindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ctype</span><span class="p">),</span>
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">lindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">setting</span><span class="p">),</span>
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ctype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lindex</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">setting</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">nindex</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetoption</span><span class="p">(</span><span class="n">optioncode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a particular analysis option.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    optioncode: EN_TRIALS       </span>
<span class="sd">                EN_ACCURACY </span>
<span class="sd">                EN_TOLERANCE </span>
<span class="sd">                EN_EMITEXPON </span>
<span class="sd">                EN_DEMANDMULT&quot;&quot;&quot;</span> 
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetoption</span><span class="p">(</span><span class="n">optioncode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENgetversion</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the current version number of the Toolkit.&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetversion</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>



<span class="c1">#---------Setting new values for network parameters-------------</span>
<span class="k">def</span> <span class="nf">ENsetcontrol</span><span class="p">(</span><span class="n">cindex</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">lindex</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="n">nindex</span><span class="p">,</span> <span class="n">level</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the parameters of a simple control statement.</span>
<span class="sd">    Arguments:</span>
<span class="sd">       cindex:  control statement index</span>
<span class="sd">       ctype:   control type code  EN_LOWLEVEL   (Low Level Control)</span>
<span class="sd">                                   EN_HILEVEL    (High Level Control)  </span>
<span class="sd">                                   EN_TIMER      (Timer Control)       </span>
<span class="sd">                                   EN_TIMEOFDAY  (Time-of-Day Control)</span>
<span class="sd">       lindex:  index of link being controlled</span>
<span class="sd">       setting: value of the control setting</span>
<span class="sd">       nindex:  index of controlling node</span>
<span class="sd">       level:   value of controlling water level or pressure for level controls</span>
<span class="sd">                or of time of control action (in seconds) for time-based controls&quot;&quot;&quot;</span>
    <span class="c1">#int ENsetcontrol(int cindex, int* ctype, int* lindex, float* setting, int* nindex, float* level )</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetcontrol</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">cindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">ctype</span><span class="p">),</span>
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">lindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">setting</span><span class="p">),</span> 
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetnodevalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a parameter for a specific node.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    index:  node index</span>
<span class="sd">    paramcode: Node parameter codes consist of the following constants:</span>
<span class="sd">                  EN_ELEVATION  Elevation</span>
<span class="sd">                  EN_BASEDEMAND ** Base demand</span>
<span class="sd">                  EN_PATTERN    ** Demand pattern index</span>
<span class="sd">                  EN_EMITTER    Emitter coeff.</span>
<span class="sd">                  EN_INITQUAL   Initial quality</span>
<span class="sd">                  EN_SOURCEQUAL Source quality</span>
<span class="sd">                  EN_SOURCEPAT  Source pattern index</span>
<span class="sd">                  EN_SOURCETYPE Source type (See note below)</span>
<span class="sd">                  EN_TANKLEVEL  Initial water level in tank</span>
<span class="sd">                       ** primary demand category is last on demand list</span>
<span class="sd">               The following parameter codes apply only to storage tank nodes</span>
<span class="sd">                  EN_TANKDIAM      Tank diameter</span>
<span class="sd">                  EN_MINVOLUME     Minimum water volume</span>
<span class="sd">                  EN_MINLEVEL      Minimum water level</span>
<span class="sd">                  EN_MAXLEVEL      Maximum water level</span>
<span class="sd">                  EN_MIXMODEL      Mixing model code</span>
<span class="sd">                  EN_MIXFRACTION   Fraction of total volume occupied by the inlet/outlet</span>
<span class="sd">                  EN_TANK_KBULK    Bulk reaction rate coefficient</span>
<span class="sd">    value:parameter value&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetnodevalue</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">paramcode</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetlinkvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a parameter for a specific link.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    index:  link index</span>
<span class="sd">    paramcode: Link parameter codes consist of the following constants:</span>
<span class="sd">                 EN_DIAMETER     Diameter</span>
<span class="sd">                 EN_LENGTH       Length</span>
<span class="sd">                 EN_ROUGHNESS    Roughness coeff.</span>
<span class="sd">                 EN_MINORLOSS    Minor loss coeff.</span>
<span class="sd">                 EN_INITSTATUS   * Initial link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_INITSETTING  * Roughness for pipes, initial speed for pumps, initial setting for valves</span>
<span class="sd">                 EN_KBULK        Bulk reaction coeff.</span>
<span class="sd">                 EN_KWALL        Wall reaction coeff.</span>
<span class="sd">                 EN_STATUS       * Actual link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_SETTING      * Roughness for pipes, actual speed for pumps, actual setting for valves</span>
<span class="sd">                 * Use EN_INITSTATUS and EN_INITSETTING to set the design value for a link&#39;s status or setting that </span>
<span class="sd">                   exists prior to the start of a simulation. Use EN_STATUS and EN_SETTING to change these values while </span>
<span class="sd">                   a simulation is being run (within the ENrunH - ENnextH loop).</span>

<span class="sd">    value:parameter value&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetlinkvalue</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> 
                              <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">paramcode</span><span class="p">),</span> 
			      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENaddpattern</span><span class="p">(</span><span class="n">patternid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds a new time pattern to the network.</span>
<span class="sd">    Arguments:</span>
<span class="sd">      id: ID label of pattern&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENaddpattern</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">patternid</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetpattern</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">factors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets all of the multiplier factors for a specific time pattern.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    index:    time pattern index</span>
<span class="sd">    factors:  multiplier factors list for the entire pattern&quot;&quot;&quot;</span>
    <span class="c1"># int ENsetpattern( int index, float* factors, int nfactors )</span>
    <span class="n">nfactors</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>
    <span class="n">cfactors_type</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="o">*</span> <span class="n">nfactors</span>
    <span class="n">cfactors</span><span class="o">=</span> <span class="n">cfactors_type</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfactors</span><span class="p">):</span>
       <span class="n">cfactors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">factors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetpattern</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">cfactors</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nfactors</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetpatternvalue</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the multiplier factor for a specific period within a time pattern.</span>
<span class="sd">    Arguments:</span>
<span class="sd">       index: time pattern index</span>
<span class="sd">       period: period within time pattern</span>
<span class="sd">       value:  multiplier factor for the period&quot;&quot;&quot;</span>
    <span class="c1">#int ENsetpatternvalue( int index, int period, float value )</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetpatternvalue</span><span class="p">(</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> 
                                  <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">period</span><span class="p">),</span> 
				  <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

 

<span class="k">def</span> <span class="nf">ENsetqualtype</span><span class="p">(</span><span class="n">qualcode</span><span class="p">,</span> <span class="n">chemname</span><span class="p">,</span> <span class="n">chemunits</span><span class="p">,</span> <span class="n">tracenode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the type of water quality analysis called for.</span>
<span class="sd">    Arguments:</span>
<span class="sd">         qualcode:	water quality analysis code</span>
<span class="sd">         chemname:	name of the chemical being analyzed</span>
<span class="sd">         chemunits:	units that the chemical is measured in</span>
<span class="sd">         tracenode:	ID of node traced in a source tracing analysis &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetqualtype</span><span class="p">(</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">qualcode</span><span class="p">),</span>
                              <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">chemname</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
			      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">chemunits</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
                              <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">tracenode</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span>  <span class="nf">ENsettimeparam</span><span class="p">(</span><span class="n">paramcode</span><span class="p">,</span> <span class="n">timevalue</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a time parameter.</span>
<span class="sd">    Arguments:</span>
<span class="sd">      paramcode: time parameter code EN_DURATION</span>
<span class="sd">                                     EN_HYDSTEP</span>
<span class="sd">                                     EN_QUALSTEP</span>
<span class="sd">                                     EN_PATTERNSTEP</span>
<span class="sd">                                     EN_PATTERNSTART</span>
<span class="sd">                                     EN_REPORTSTEP</span>
<span class="sd">                                     EN_REPORTSTART</span>
<span class="sd">                                     EN_RULESTEP</span>
<span class="sd">                                     EN_STATISTIC</span>
<span class="sd">                                     EN_PERIODS</span>
<span class="sd">      timevalue: value of time parameter in seconds</span>
<span class="sd">                      The codes for EN_STATISTIC are:</span>
<span class="sd">                      EN_NONE     none</span>
<span class="sd">                      EN_AVERAGE  averaged</span>
<span class="sd">                      EN_MINIMUM  minimums</span>
<span class="sd">                      EN_MAXIMUM  maximums</span>
<span class="sd">                      EN_RANGE    ranges&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsettimeparam</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">paramcode</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">timevalue</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetoption</span><span class="p">(</span> <span class="n">optioncode</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a particular analysis option.</span>

<span class="sd">    Arguments:</span>
<span class="sd">      optioncode: option code EN_TRIALS</span>
<span class="sd">                              EN_ACCURACY  </span>
<span class="sd">                              EN_TOLERANCE </span>
<span class="sd">                              EN_EMITEXPON </span>
<span class="sd">                              EN_DEMANDMULT</span>
<span class="sd">      value:  option value&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetoption</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">optioncode</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="c1">#----- Saving and using hydraulic analysis results files -------</span>
<span class="k">def</span> <span class="nf">ENsavehydfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves the current contents of the binary hydraulics file to a file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsavehydfile</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span>  <span class="nf">ENusehydfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uses the contents of the specified file as the current binary hydraulics file&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENusehydfile</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>



<span class="c1">#----------Running a hydraulic analysis --------------------------</span>
<span class="k">def</span> <span class="nf">ENsolveH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Runs a complete hydraulic simulation with results </span>
<span class="sd">    for all time periods written to the binary Hydraulics file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENopenH</span><span class="p">():</span> 
    <span class="sd">&quot;&quot;&quot;Opens the hydraulics analysis system&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENinitH</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes storage tank levels, link status and settings, </span>
<span class="sd">    and the simulation clock time prior</span>
<span class="sd">to running a hydraulic analysis.</span>

<span class="sd">    flag  EN_NOSAVE [+EN_SAVE] [+EN_INITFLOW] &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENinitH</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENrunH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Runs a single period hydraulic analysis, </span>
<span class="sd">    retrieving the current simulation clock time t&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENrunH</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_current_simulation_time</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">&gt;=</span><span class="mi">100</span><span class="p">:</span> 
      <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">ENgeterror</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsimtime</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;retrieves the current simulation time t as datetime.timedelta instance&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span> <span class="n">_current_simulation_time</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">ENnextH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Determines the length of time until the next hydraulic event occurs in an extended period</span>
<span class="sd">       simulation.&quot;&quot;&quot;</span>
    <span class="n">_deltat</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENnextH</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_deltat</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_deltat</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENcloseH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Closes the hydraulic analysis system, freeing all allocated memory.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="c1"># --------------------------------------------</span>

<span class="c1">#----------Running a quality analysis --------------------------</span>
<span class="k">def</span> <span class="nf">ENsolveQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Runs a complete water quality simulation with results </span>
<span class="sd">    at uniform reporting intervals written to EPANET&#39;s binary Output file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENopenQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Opens the water quality analysis system&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">ENinitQ</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes water quality and the simulation clock </span>
<span class="sd">    time prior to running a water quality analysis.</span>

<span class="sd">    flag  EN_NOSAVE | EN_SAVE &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENinitQ</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENrunQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Makes available the hydraulic and water quality results</span>
<span class="sd">    that occur at the start of the next time period of a water quality analysis, </span>
<span class="sd">    where the start of the period is returned in t.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENrunQ</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_current_simulation_time</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">&gt;=</span><span class="mi">100</span><span class="p">:</span> 
      <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">ENgeterror</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENnextQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Advances the water quality simulation </span>
<span class="sd">    to the start of the next hydraulic time period.&quot;&quot;&quot;</span>
    <span class="n">_deltat</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENnextQ</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_deltat</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_deltat</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENstepQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Advances the water quality simulation one water quality time step. </span>
<span class="sd">    The time remaining in the overall simulation is returned in tleft.&quot;&quot;&quot;</span>
    <span class="n">tleft</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENnextQ</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">tleft</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tleft</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENcloseQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Closes the water quality analysis system, </span>
<span class="sd">    freeing all allocated memory.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENcloseQ</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<span class="c1">#--------------------------------------------</span>





<span class="k">def</span> <span class="nf">ENsaveH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Transfers results of a hydraulic simulation </span>
<span class="sd">    from the binary Hydraulics file to the binary</span>
<span class="sd">    Output file, where results are only reported at </span>
<span class="sd">    uniform reporting intervals.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsaveinpfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes all current network input data to a file </span>
<span class="sd">    using the format of an EPANET input file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsaveinpfile</span><span class="p">(</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENreport</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Writes a formatted text report on simulation results </span>
<span class="sd">    to the Report file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENresetreport</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Clears any report formatting commands </span>
<span class="sd">    </span>
<span class="sd">    that either appeared in the [REPORT] section of the </span>
<span class="sd">    EPANET Input file or were issued with the </span>
<span class="sd">    ENsetreport function&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENresetreport</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENsetreport</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Issues a report formatting command. </span>
<span class="sd">    </span>
<span class="sd">    Formatting commands are the same as used in the </span>
<span class="sd">    [REPORT] section of the EPANET Input file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENsetstatusreport</span><span class="p">(</span><span class="n">statuslevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the level of hydraulic status reporting. </span>
<span class="sd">    </span>
<span class="sd">    statuslevel:  level of status reporting  </span>
<span class="sd">                  0 - no status reporting</span>
<span class="sd">                  1 - normal reporting</span>
<span class="sd">                  2 - full status reporting&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetstatusreport</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">statuslevel</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENgeterror</span><span class="p">(</span><span class="n">errcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the text of the message associated with a particular error or warning code.&quot;&quot;&quot;</span>
    <span class="n">errmsg</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_err_max_char</span><span class="p">)</span>
    <span class="n">_lib</span><span class="o">.</span><span class="n">ENgeterror</span><span class="p">(</span> <span class="n">errcode</span><span class="p">,</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">errmsg</span><span class="p">),</span> <span class="n">_err_max_char</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">errmsg</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">ENwriteline</span><span class="p">(</span><span class="n">line</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes a line of text to the EPANET report file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENwriteline</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ENtoolkitError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ierr</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="o">=</span> <span class="n">ierr</span> <span class="o">&lt;</span> <span class="mi">100</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">=</span> <span class="p">(</span><span class="n">ierr</span><span class="p">,)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">=</span> <span class="n">ENgeterror</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;ENtoolkit Undocumented Error &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: look at text.h in epanet sources&#39;</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>


<span class="c1">#------ functions added from OpenWaterAnalytics ----------------------------------</span>
<span class="c1"># functions not present in original Epanet2 toolkit from US EPA</span>
<span class="c1"># it may change in future versions</span>
<span class="c1">#----------------------------------------------------------------------------------</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_lib</span><span class="p">,</span><span class="s2">&quot;ENgetcurve&quot;</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">ENgetcurve</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">):</span>
       <span class="n">curveid</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
       <span class="n">nValues</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
       <span class="n">xValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">yValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcurve</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">,</span>
                             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">curveid</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">xValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">yValues</span><span class="p">)</span>
		             <span class="p">)</span>
       <span class="c1"># strange behavior of ENgetcurve: it returns also curveID</span>
       <span class="c1"># better split in two distinct functions ....</span>
       <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
       <span class="n">curve</span><span class="o">=</span> <span class="p">[]</span>
       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nValues</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
          <span class="n">curve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">xValues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">yValues</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
       <span class="k">return</span> <span class="n">curve</span>

   <span class="k">def</span> <span class="nf">ENgetcurveid</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">):</span>
       <span class="n">curveid</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
       <span class="n">nValues</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
       <span class="n">xValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">yValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcurve</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">,</span>
                             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">curveid</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">xValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">yValues</span><span class="p">)</span>
		             <span class="p">)</span>
       <span class="c1"># strange behavior of ENgetcurve: it returns also curveID</span>
       <span class="c1"># better split in two distinct functions ....</span>
       <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
       <span class="k">return</span> <span class="n">curveid</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># -----end of functions added from OpenWaterAnalytics ----------------------------------</span>


<span class="n">EN_ELEVATION</span>     <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Node parameters */</span>
<span class="n">EN_BASEDEMAND</span>    <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_PATTERN</span>       <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_EMITTER</span>       <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_INITQUAL</span>      <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_SOURCEQUAL</span>    <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_SOURCEPAT</span>     <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_SOURCETYPE</span>    <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_TANKLEVEL</span>     <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_DEMAND</span>        <span class="o">=</span> <span class="mi">9</span>
<span class="n">EN_HEAD</span>          <span class="o">=</span> <span class="mi">10</span>
<span class="n">EN_PRESSURE</span>      <span class="o">=</span> <span class="mi">11</span>
<span class="n">EN_QUALITY</span>       <span class="o">=</span> <span class="mi">12</span>
<span class="n">EN_SOURCEMASS</span>    <span class="o">=</span> <span class="mi">13</span>
<span class="n">EN_INITVOLUME</span>    <span class="o">=</span> <span class="mi">14</span>
<span class="n">EN_MIXMODEL</span>      <span class="o">=</span> <span class="mi">15</span>
<span class="n">EN_MIXZONEVOL</span>    <span class="o">=</span> <span class="mi">16</span>

<span class="n">EN_TANKDIAM</span>      <span class="o">=</span> <span class="mi">17</span>
<span class="n">EN_MINVOLUME</span>     <span class="o">=</span> <span class="mi">18</span>
<span class="n">EN_VOLCURVE</span>      <span class="o">=</span> <span class="mi">19</span>
<span class="n">EN_MINLEVEL</span>      <span class="o">=</span> <span class="mi">20</span>
<span class="n">EN_MAXLEVEL</span>      <span class="o">=</span> <span class="mi">21</span>
<span class="n">EN_MIXFRACTION</span>   <span class="o">=</span> <span class="mi">22</span>
<span class="n">EN_TANK_KBULK</span>    <span class="o">=</span> <span class="mi">23</span>

<span class="n">EN_DIAMETER</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Link parameters */</span>
<span class="n">EN_LENGTH</span>        <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_ROUGHNESS</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_MINORLOSS</span>     <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_INITSTATUS</span>    <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_INITSETTING</span>   <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_KBULK</span>         <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_KWALL</span>         <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_FLOW</span>          <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_VELOCITY</span>      <span class="o">=</span> <span class="mi">9</span>
<span class="n">EN_HEADLOSS</span>      <span class="o">=</span> <span class="mi">10</span>
<span class="n">EN_STATUS</span>        <span class="o">=</span> <span class="mi">11</span>
<span class="n">EN_SETTING</span>       <span class="o">=</span> <span class="mi">12</span>
<span class="n">EN_ENERGY</span>        <span class="o">=</span> <span class="mi">13</span>

<span class="n">EN_DURATION</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Time parameters */</span>
<span class="n">EN_HYDSTEP</span>       <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_QUALSTEP</span>      <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_PATTERNSTEP</span>   <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_PATTERNSTART</span>  <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_REPORTSTEP</span>    <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_REPORTSTART</span>   <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_RULESTEP</span>      <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_STATISTIC</span>     <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_PERIODS</span>       <span class="o">=</span> <span class="mi">9</span>

<span class="n">EN_NODECOUNT</span>     <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Component counts */</span>
<span class="n">EN_TANKCOUNT</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_LINKCOUNT</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_PATCOUNT</span>      <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_CURVECOUNT</span>    <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_CONTROLCOUNT</span>  <span class="o">=</span> <span class="mi">5</span>

<span class="n">EN_JUNCTION</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Node types */</span>
<span class="n">EN_RESERVOIR</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_TANK</span>          <span class="o">=</span> <span class="mi">2</span>

<span class="n">EN_CVPIPE</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Link types */</span>
<span class="n">EN_PIPE</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_PUMP</span>          <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_PRV</span>           <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_PSV</span>           <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_PBV</span>           <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_FCV</span>           <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_TCV</span>           <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_GPV</span>           <span class="o">=</span> <span class="mi">8</span>

<span class="n">EN_NONE</span>          <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Quality analysis types */</span>
<span class="n">EN_CHEM</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_AGE</span>           <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_TRACE</span>         <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_CONCEN</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Source quality types */</span>
<span class="n">EN_MASS</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_SETPOINT</span>      <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_FLOWPACED</span>     <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_CFS</span>           <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Flow units types */</span>
<span class="n">EN_GPM</span>           <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_MGD</span>           <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_IMGD</span>          <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_AFD</span>           <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_LPS</span>           <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_LPM</span>           <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_MLD</span>           <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_CMH</span>           <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_CMD</span>           <span class="o">=</span> <span class="mi">9</span>

<span class="n">EN_TRIALS</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Misc. options */</span>
<span class="n">EN_ACCURACY</span>      <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_TOLERANCE</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_EMITEXPON</span>     <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_DEMANDMULT</span>    <span class="o">=</span> <span class="mi">4</span>

<span class="n">EN_LOWLEVEL</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Control types */</span>
<span class="n">EN_HILEVEL</span>       <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_TIMER</span>         <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_TIMEOFDAY</span>     <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_AVERAGE</span>       <span class="o">=</span> <span class="mi">1</span>      <span class="c1"># /* Time statistic types.    */</span>
<span class="n">EN_MINIMUM</span>       <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_MAXIMUM</span>       <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_RANGE</span>         <span class="o">=</span> <span class="mi">4</span>

<span class="n">EN_MIX1</span>          <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Tank mixing models */</span>
<span class="n">EN_MIX2</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_FIFO</span>          <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_LIFO</span>          <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_NOSAVE</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Save-results-to-file flag */</span>
<span class="n">EN_SAVE</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_INITFLOW</span>      <span class="o">=</span> <span class="mi">10</span>     <span class="c1"># /* Re-initialize flow flag   */</span>



<span class="n">FlowUnits</span><span class="o">=</span> <span class="p">{</span> <span class="n">EN_CFS</span> <span class="p">:</span><span class="s2">&quot;cfs&quot;</span>   <span class="p">,</span>
             <span class="n">EN_GPM</span> <span class="p">:</span><span class="s2">&quot;gpm&quot;</span>   <span class="p">,</span>
             <span class="n">EN_MGD</span> <span class="p">:</span><span class="s2">&quot;a-f/d&quot;</span> <span class="p">,</span>
             <span class="n">EN_IMGD</span><span class="p">:</span><span class="s2">&quot;mgd&quot;</span>   <span class="p">,</span>
             <span class="n">EN_AFD</span> <span class="p">:</span><span class="s2">&quot;Imgd&quot;</span>  <span class="p">,</span>
             <span class="n">EN_LPS</span> <span class="p">:</span><span class="s2">&quot;L/s&quot;</span>   <span class="p">,</span>
             <span class="n">EN_LPM</span> <span class="p">:</span><span class="s2">&quot;Lpm&quot;</span>   <span class="p">,</span>
             <span class="n">EN_MLD</span> <span class="p">:</span><span class="s2">&quot;m3/h&quot;</span>  <span class="p">,</span>
             <span class="n">EN_CMH</span> <span class="p">:</span><span class="s2">&quot;m3/d&quot;</span>  <span class="p">,</span>
             <span class="n">EN_CMD</span> <span class="p">:</span><span class="s2">&quot;ML/d&quot;</span>  <span class="p">}</span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Python EpanetToolkit interface</span>

<span class="sd">added function ENsimtime&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">_plat</span><span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
<span class="k">if</span> <span class="n">_plat</span><span class="o">==</span><span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
  <span class="n">_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">&quot;./libepanet2.so&quot;</span><span class="p">)</span>
<span class="c1">##  _lib = ctypes.CDLL(&quot;./en2tools.so.1.5.0&quot;)</span>
<span class="c1">##  _lib = ctypes.CDLL(&quot;./epanet2toolkit.so&quot;)</span>
<span class="k">elif</span> <span class="n">_plat</span><span class="o">==</span><span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="c1"># if epanet2.dll compiled with __cdecl (as in OpenWaterAnalytics)</span>
    <span class="n">_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">&quot;epamodule\epanet2.dll&quot;</span><span class="p">)</span>
    <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetversion</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()))</span>
  <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
     <span class="c1"># if epanet2.dll compiled with __stdcall (as in EPA original DLL)</span>
     <span class="k">try</span><span class="p">:</span>
       <span class="n">_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">epanet2</span>
       <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetversion</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()))</span>
     <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
       <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;epanet2.dll not suitable&quot;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
  <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Platform &#39;</span><span class="o">+</span> <span class="n">_plat</span> <span class="o">+</span><span class="s1">&#39; unsupported (not yet)&#39;</span><span class="p">)</span>


<span class="n">_current_simulation_time</span><span class="o">=</span>  <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>

<span class="n">_max_label_len</span><span class="o">=</span> <span class="mi">32</span>
<span class="n">_err_max_char</span><span class="o">=</span> <span class="mi">80</span>





<span class="k">def</span> <span class="nf">ENepanet</span><span class="p">(</span><span class="n">nomeinp</span><span class="p">,</span> <span class="n">nomerpt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nomebin</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs a complete EPANET simulation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    nomeinp: name of the input file</span>
<span class="sd">    nomerpt: name of an output report file</span>
<span class="sd">    nomebin: name of an optional binary output file</span>
<span class="sd">    vfunc  : pointer to a user-supplied function which accepts a character string as its argument.&quot;&quot;&quot;</span>  
    <span class="k">if</span> <span class="n">vfunc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">CFUNC</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CFUNCTYPE</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">)</span>
        <span class="n">callback</span><span class="o">=</span> <span class="n">CFUNC</span><span class="p">(</span><span class="n">vfunc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">callback</span><span class="o">=</span> <span class="kc">None</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENepanet</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomeinp</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                        <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomerpt</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                        <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomebin</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                        <span class="n">callback</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENopen</span><span class="p">(</span><span class="n">nomeinp</span><span class="p">,</span> <span class="n">nomerpt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nomebin</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Opens the Toolkit to analyze a particular distribution system</span>

<span class="sd">    Arguments:</span>
<span class="sd">    nomeinp: name of the input file</span>
<span class="sd">    nomerpt: name of an output report file</span>
<span class="sd">    nomebin: name of an optional binary output file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENopen</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomeinp</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomerpt</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> 
                      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nomebin</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> 
      <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENclose</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Closes down the Toolkit system (including all files being processed)&quot;&quot;&quot;</span>
  <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENclose</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENgetnodeindex</span><span class="p">(</span><span class="n">nodeid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the index of a node with a specified ID.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    nodeid: node ID label&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodeindex</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">nodeid</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetnodeid</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the ID label of a node with a specified index.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: node index&quot;&quot;&quot;</span>    
    <span class="n">label</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodeid</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENsettitle</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span><span class="n">line2</span><span class="p">,</span><span class="n">line3</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Set inp file title</span>
<span class="sd">	</span>
<span class="sd">	Arguments:</span>
<span class="sd">	line1: line 1 of 3 inp title lines</span>
<span class="sd">	line2: line 2 of 3 inp title lines</span>
<span class="sd">	line3: line 3 of 3 inp title lines&quot;&quot;&quot;</span>
	<span class="n">ierr</span> <span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsettitle</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
			       <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line2</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
			       <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line3</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
	<span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetflowunits</span><span class="p">(</span><span class="n">units_code</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set flow units</span>

<span class="sd">    Arguments:</span>
<span class="sd">    units_code:	int code for unit type:</span>
<span class="sd">        EN_CFS	0	cubic feet per second</span>
<span class="sd">        EN_GPM	1	gallons per minute</span>
<span class="sd">        EN_MGD	2	million gallons per day</span>
<span class="sd">        EN_IMGD	3	Imperial mgd</span>
<span class="sd">        EN_AFD	4	acre-feet per day</span>
<span class="sd">        EN_LPS	5	liters per second</span>
<span class="sd">        EN_LPM	6	liters per minute</span>
<span class="sd">        EN_MLD	7	million liters per day</span>
<span class="sd">        EN_CMH	8	cubic meters per hour</span>
<span class="sd">        EN_CMD	9	cubic meters per day</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ierr</span> <span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetflowunits</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">units_code</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENgetnodetype</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the node-type code for a specific node.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: node index&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodetype</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetnodevalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a specific node parameter.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:     node index</span>
<span class="sd">    paramcode: Node parameter codes consist of the following constants:</span>
<span class="sd">                  EN_ELEVATION  Elevation</span>
<span class="sd">                  EN_BASEDEMAND ** Base demand</span>
<span class="sd">                  EN_PATTERN    ** Demand pattern index</span>
<span class="sd">                  EN_EMITTER    Emitter coeff.</span>
<span class="sd">                  EN_INITQUAL   Initial quality</span>
<span class="sd">                  EN_SOURCEQUAL Source quality</span>
<span class="sd">                  EN_SOURCEPAT  Source pattern index</span>
<span class="sd">                  EN_SOURCETYPE Source type (See note below)</span>
<span class="sd">                  EN_TANKLEVEL  Initial water level in tank</span>
<span class="sd">                  EN_DEMAND     * Actual demand</span>
<span class="sd">                  EN_HEAD       * Hydraulic head</span>
<span class="sd">                  EN_PRESSURE   * Pressure</span>
<span class="sd">                  EN_QUALITY    * Actual quality</span>
<span class="sd">                  EN_SOURCEMASS * Mass flow rate per minute of a chemical source</span>
<span class="sd">                    * computed values)</span>
<span class="sd">                   ** primary demand category is last on demand list</span>

<span class="sd">               The following parameter codes apply only to storage tank nodes:</span>
<span class="sd">                  EN_INITVOLUME  Initial water volume</span>
<span class="sd">                  EN_MIXMODEL    Mixing model code (see below)</span>
<span class="sd">                  EN_MIXZONEVOL  Inlet/Outlet zone volume in a 2-compartment tank</span>
<span class="sd">                  EN_TANKDIAM    Tank diameter</span>
<span class="sd">                  EN_MINVOLUME   Minimum water volume</span>
<span class="sd">                  EN_VOLCURVE    Index of volume versus depth curve (0 if none assigned)</span>
<span class="sd">                  EN_MINLEVEL    Minimum water level</span>
<span class="sd">                  EN_MAXLEVEL    Maximum water level</span>
<span class="sd">                  EN_MIXFRACTION Fraction of total volume occupied by the inlet/outlet zone in a 2-compartment tank</span>
<span class="sd">                  EN_TANK_KBULK  Bulk reaction rate coefficient&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetnodevalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="c1">##------</span>
<span class="k">def</span> <span class="nf">ENgetlinkindex</span><span class="p">(</span><span class="n">linkid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the index of a link with a specified ID.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    linkid: link ID label&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinkindex</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">linkid</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetlinkid</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the ID label of a link with a specified index.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: link index&quot;&quot;&quot;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinkid</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetlinktype</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the link-type code for a specific link.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: link index&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinktype</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetlinknodes</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the indexes of the end nodes of a specified link.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: link index&quot;&quot;&quot;</span>
    <span class="n">j1</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">j2</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinknodes</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">j2</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENgetlinkvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a specific link parameter.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:     link index</span>
<span class="sd">    paramcode: Link parameter codes consist of the following constants:</span>
<span class="sd">                 EN_DIAMETER     Diameter</span>
<span class="sd">                 EN_LENGTH       Length</span>
<span class="sd">                 EN_ROUGHNESS    Roughness coeff.</span>
<span class="sd">                 EN_MINORLOSS    Minor loss coeff.</span>
<span class="sd">                 EN_INITSTATUS   Initial link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_INITSETTING  Roughness for pipes, initial speed for pumps, initial setting for valves</span>
<span class="sd">                 EN_KBULK        Bulk reaction coeff.</span>
<span class="sd">                 EN_KWALL        Wall reaction coeff.</span>
<span class="sd">                 EN_FLOW         * Flow rate</span>
<span class="sd">                 EN_VELOCITY     * Flow velocity</span>
<span class="sd">                 EN_HEADLOSS     * Head loss</span>
<span class="sd">                 EN_STATUS       * Actual link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_SETTING      * Roughness for pipes, actual speed for pumps, actual setting for valves</span>
<span class="sd">                 EN_ENERGY       * Energy expended in kwatts</span>
<span class="sd">                   * computed values&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetlinkvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>
<span class="c1">#------</span>

<span class="k">def</span> <span class="nf">ENgetpatternid</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the ID label of a particular time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index: pattern index&quot;&quot;&quot;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternid</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENgetpatternindex</span><span class="p">(</span><span class="n">patternid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the index of a particular time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    id: pattern ID label&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternindex</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">patternid</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetpatternlen</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the number of time periods in a specific time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:pattern index&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternlen</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetpatternvalue</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the multiplier factor for a specific time period in a time pattern.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    index:  time pattern index</span>
<span class="sd">    period: period within time pattern&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetpatternvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>



<span class="k">def</span> <span class="nf">ENgetcount</span><span class="p">(</span><span class="n">countcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the number of network components of a specified type.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    countcode: component code EN_NODECOUNT</span>
<span class="sd">                              EN_TANKCOUNT</span>
<span class="sd">                              EN_LINKCOUNT</span>
<span class="sd">                              EN_PATCOUNT</span>
<span class="sd">                              EN_CURVECOUNT</span>
<span class="sd">                              EN_CONTROLCOUNT&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcount</span><span class="p">(</span><span class="n">countcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetflowunits</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Retrieves a code number indicating the units used to express all flow rates.&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetflowunits</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>    


<span class="k">def</span> <span class="nf">ENgettimeparam</span><span class="p">(</span><span class="n">paramcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a specific analysis time parameter.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    paramcode: EN_DURATION     </span>
<span class="sd">               EN_HYDSTEP</span>
<span class="sd">               EN_QUALSTEP</span>
<span class="sd">               EN_PATTERNSTEP</span>
<span class="sd">               EN_PATTERNSTART</span>
<span class="sd">               EN_REPORTSTEP</span>
<span class="sd">               EN_REPORTSTART</span>
<span class="sd">               EN_RULESTEP</span>
<span class="sd">               EN_STATISTIC</span>
<span class="sd">               EN_PERIODS&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgettimeparam</span><span class="p">(</span><span class="n">paramcode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span>  <span class="nf">ENgetqualtype</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the type of water quality analysis called for</span>
<span class="sd">    returns  qualcode: Water quality analysis codes are as follows:</span>
<span class="sd">                       EN_NONE	0 No quality analysis</span>
<span class="sd">                       EN_CHEM	1 Chemical analysis</span>
<span class="sd">                       EN_AGE 	2 Water age analysis</span>
<span class="sd">                       EN_TRACE	3 Source tracing</span>
<span class="sd">             tracenode:	index of node traced in a source tracing</span>
<span class="sd">	                analysis  (value will be 0 when qualcode</span>
<span class="sd">			is not EN_TRACE)&quot;&quot;&quot;</span>
    <span class="n">qualcode</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">tracenode</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetqualtype</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">qualcode</span><span class="p">),</span>
                             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">tracenode</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qualcode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tracenode</span><span class="o">.</span><span class="n">value</span>



<span class="c1">#-------Retrieving other network information--------</span>
<span class="k">def</span> <span class="nf">ENgetcontrol</span><span class="p">(</span><span class="n">cindex</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the parameters of a simple control statement.</span>
<span class="sd">    Arguments:</span>
<span class="sd">       cindex:  control statement index</span>
<span class="sd">       ctype:   control type code EN_LOWLEVEL   (Low Level Control)</span>
<span class="sd">                                  EN_HILEVEL    (High Level Control)</span>
<span class="sd">                                  EN_TIMER      (Timer Control)       </span>
<span class="sd">                                  EN_TIMEOFDAY  (Time-of-Day Control)</span>
<span class="sd">       lindex:  index of link being controlled</span>
<span class="sd">       setting: value of the control setting</span>
<span class="sd">       nindex:  index of controlling node</span>
<span class="sd">       level:   value of controlling water level or pressure for level controls </span>
<span class="sd">                or of time of control action (in seconds) for time-based controls&quot;&quot;&quot;</span>
    <span class="c1">#int ENgetcontrol(int cindex, int* ctype, int* lindex, float* setting, int* nindex, float* level )</span>
    <span class="n">ctype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">lindex</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">setting</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">nindex</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>

    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcontrol</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">cindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ctype</span><span class="p">),</span>
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">lindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">setting</span><span class="p">),</span>
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ctype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lindex</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">setting</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">nindex</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENgetoption</span><span class="p">(</span><span class="n">optioncode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the value of a particular analysis option.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    optioncode: EN_TRIALS       </span>
<span class="sd">                EN_ACCURACY </span>
<span class="sd">                EN_TOLERANCE </span>
<span class="sd">                EN_EMITEXPON </span>
<span class="sd">                EN_DEMANDMULT&quot;&quot;&quot;</span> 
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetoption</span><span class="p">(</span><span class="n">optioncode</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENgetversion</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the current version number of the Toolkit.&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetversion</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">value</span>



<span class="c1">#---------Setting new values for network parameters-------------</span>
<span class="k">def</span> <span class="nf">ENsetcontrol</span><span class="p">(</span><span class="n">cindex</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">lindex</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="n">nindex</span><span class="p">,</span> <span class="n">level</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the parameters of a simple control statement.</span>
<span class="sd">    Arguments:</span>
<span class="sd">       cindex:  control statement index</span>
<span class="sd">       ctype:   control type code  EN_LOWLEVEL   (Low Level Control)</span>
<span class="sd">                                   EN_HILEVEL    (High Level Control)  </span>
<span class="sd">                                   EN_TIMER      (Timer Control)       </span>
<span class="sd">                                   EN_TIMEOFDAY  (Time-of-Day Control)</span>
<span class="sd">       lindex:  index of link being controlled</span>
<span class="sd">       setting: value of the control setting</span>
<span class="sd">       nindex:  index of controlling node</span>
<span class="sd">       level:   value of controlling water level or pressure for level controls</span>
<span class="sd">                or of time of control action (in seconds) for time-based controls&quot;&quot;&quot;</span>
    <span class="c1">#int ENsetcontrol(int cindex, int* ctype, int* lindex, float* setting, int* nindex, float* level )</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetcontrol</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">cindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">ctype</span><span class="p">),</span>
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">lindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">setting</span><span class="p">),</span> 
                            <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nindex</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetnodevalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a parameter for a specific node.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    index:  node index</span>
<span class="sd">    paramcode: Node parameter codes consist of the following constants:</span>
<span class="sd">                  EN_ELEVATION  Elevation</span>
<span class="sd">                  EN_BASEDEMAND ** Base demand</span>
<span class="sd">                  EN_PATTERN    ** Demand pattern index</span>
<span class="sd">                  EN_EMITTER    Emitter coeff.</span>
<span class="sd">                  EN_INITQUAL   Initial quality</span>
<span class="sd">                  EN_SOURCEQUAL Source quality</span>
<span class="sd">                  EN_SOURCEPAT  Source pattern index</span>
<span class="sd">                  EN_SOURCETYPE Source type (See note below)</span>
<span class="sd">                  EN_TANKLEVEL  Initial water level in tank</span>
<span class="sd">                       ** primary demand category is last on demand list</span>
<span class="sd">               The following parameter codes apply only to storage tank nodes</span>
<span class="sd">                  EN_TANKDIAM      Tank diameter</span>
<span class="sd">                  EN_MINVOLUME     Minimum water volume</span>
<span class="sd">                  EN_MINLEVEL      Minimum water level</span>
<span class="sd">                  EN_MAXLEVEL      Maximum water level</span>
<span class="sd">                  EN_MIXMODEL      Mixing model code</span>
<span class="sd">                  EN_MIXFRACTION   Fraction of total volume occupied by the inlet/outlet</span>
<span class="sd">                  EN_TANK_KBULK    Bulk reaction rate coefficient</span>
<span class="sd">    value:parameter value&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetnodevalue</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">paramcode</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetlinkvalue</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">paramcode</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a parameter for a specific link.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    index:  link index</span>
<span class="sd">    paramcode: Link parameter codes consist of the following constants:</span>
<span class="sd">                 EN_DIAMETER     Diameter</span>
<span class="sd">                 EN_LENGTH       Length</span>
<span class="sd">                 EN_ROUGHNESS    Roughness coeff.</span>
<span class="sd">                 EN_MINORLOSS    Minor loss coeff.</span>
<span class="sd">                 EN_INITSTATUS   * Initial link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_INITSETTING  * Roughness for pipes, initial speed for pumps, initial setting for valves</span>
<span class="sd">                 EN_KBULK        Bulk reaction coeff.</span>
<span class="sd">                 EN_KWALL        Wall reaction coeff.</span>
<span class="sd">                 EN_STATUS       * Actual link status (0 = closed, 1 = open)</span>
<span class="sd">                 EN_SETTING      * Roughness for pipes, actual speed for pumps, actual setting for valves</span>
<span class="sd">                 * Use EN_INITSTATUS and EN_INITSETTING to set the design value for a link&#39;s status or setting that </span>
<span class="sd">                   exists prior to the start of a simulation. Use EN_STATUS and EN_SETTING to change these values while </span>
<span class="sd">                   a simulation is being run (within the ENrunH - ENnextH loop).</span>

<span class="sd">    value:parameter value&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetlinkvalue</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> 
                              <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">paramcode</span><span class="p">),</span> 
			      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENaddpattern</span><span class="p">(</span><span class="n">patternid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds a new time pattern to the network.</span>
<span class="sd">    Arguments:</span>
<span class="sd">      id: ID label of pattern&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENaddpattern</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">patternid</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetpattern</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">factors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets all of the multiplier factors for a specific time pattern.</span>
<span class="sd">    Arguments:</span>
<span class="sd">    index:    time pattern index</span>
<span class="sd">    factors:  multiplier factors list for the entire pattern&quot;&quot;&quot;</span>
    <span class="c1"># int ENsetpattern( int index, float* factors, int nfactors )</span>
    <span class="n">nfactors</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>
    <span class="n">cfactors_type</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="o">*</span> <span class="n">nfactors</span>
    <span class="n">cfactors</span><span class="o">=</span> <span class="n">cfactors_type</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfactors</span><span class="p">):</span>
       <span class="n">cfactors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">factors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetpattern</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">cfactors</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nfactors</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetpatternvalue</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the multiplier factor for a specific period within a time pattern.</span>
<span class="sd">    Arguments:</span>
<span class="sd">       index: time pattern index</span>
<span class="sd">       period: period within time pattern</span>
<span class="sd">       value:  multiplier factor for the period&quot;&quot;&quot;</span>
    <span class="c1">#int ENsetpatternvalue( int index, int period, float value )</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetpatternvalue</span><span class="p">(</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> 
                                  <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">period</span><span class="p">),</span> 
				  <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

 

<span class="k">def</span> <span class="nf">ENsetqualtype</span><span class="p">(</span><span class="n">qualcode</span><span class="p">,</span> <span class="n">chemname</span><span class="p">,</span> <span class="n">chemunits</span><span class="p">,</span> <span class="n">tracenode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the type of water quality analysis called for.</span>
<span class="sd">    Arguments:</span>
<span class="sd">         qualcode:	water quality analysis code</span>
<span class="sd">         chemname:	name of the chemical being analyzed</span>
<span class="sd">         chemunits:	units that the chemical is measured in</span>
<span class="sd">         tracenode:	ID of node traced in a source tracing analysis &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetqualtype</span><span class="p">(</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">qualcode</span><span class="p">),</span>
                              <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">chemname</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
			      <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">chemunits</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
                              <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">tracenode</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span>  <span class="nf">ENsettimeparam</span><span class="p">(</span><span class="n">paramcode</span><span class="p">,</span> <span class="n">timevalue</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a time parameter.</span>
<span class="sd">    Arguments:</span>
<span class="sd">      paramcode: time parameter code EN_DURATION</span>
<span class="sd">                                     EN_HYDSTEP</span>
<span class="sd">                                     EN_QUALSTEP</span>
<span class="sd">                                     EN_PATTERNSTEP</span>
<span class="sd">                                     EN_PATTERNSTART</span>
<span class="sd">                                     EN_REPORTSTEP</span>
<span class="sd">                                     EN_REPORTSTART</span>
<span class="sd">                                     EN_RULESTEP</span>
<span class="sd">                                     EN_STATISTIC</span>
<span class="sd">                                     EN_PERIODS</span>
<span class="sd">      timevalue: value of time parameter in seconds</span>
<span class="sd">                      The codes for EN_STATISTIC are:</span>
<span class="sd">                      EN_NONE     none</span>
<span class="sd">                      EN_AVERAGE  averaged</span>
<span class="sd">                      EN_MINIMUM  minimums</span>
<span class="sd">                      EN_MAXIMUM  maximums</span>
<span class="sd">                      EN_RANGE    ranges&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsettimeparam</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">paramcode</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">timevalue</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsetoption</span><span class="p">(</span> <span class="n">optioncode</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the value of a particular analysis option.</span>

<span class="sd">    Arguments:</span>
<span class="sd">      optioncode: option code EN_TRIALS</span>
<span class="sd">                              EN_ACCURACY  </span>
<span class="sd">                              EN_TOLERANCE </span>
<span class="sd">                              EN_EMITEXPON </span>
<span class="sd">                              EN_DEMANDMULT</span>
<span class="sd">      value:  option value&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetoption</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">optioncode</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="c1">#----- Saving and using hydraulic analysis results files -------</span>
<span class="k">def</span> <span class="nf">ENsavehydfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves the current contents of the binary hydraulics file to a file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsavehydfile</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span>  <span class="nf">ENusehydfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uses the contents of the specified file as the current binary hydraulics file&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENusehydfile</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>



<span class="c1">#----------Running a hydraulic analysis --------------------------</span>
<span class="k">def</span> <span class="nf">ENsolveH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Runs a complete hydraulic simulation with results </span>
<span class="sd">    for all time periods written to the binary Hydraulics file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsolveH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENopenH</span><span class="p">():</span> 
    <span class="sd">&quot;&quot;&quot;Opens the hydraulics analysis system&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENopenH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENinitH</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes storage tank levels, link status and settings, </span>
<span class="sd">    and the simulation clock time prior</span>
<span class="sd">to running a hydraulic analysis.</span>

<span class="sd">    flag  EN_NOSAVE [+EN_SAVE] [+EN_INITFLOW] &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENinitH</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENrunH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Runs a single period hydraulic analysis, </span>
<span class="sd">    retrieving the current simulation clock time t&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENrunH</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_current_simulation_time</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">&gt;=</span><span class="mi">100</span><span class="p">:</span> 
      <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">ENgeterror</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsimtime</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;retrieves the current simulation time t as datetime.timedelta instance&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span> <span class="n">_current_simulation_time</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">ENnextH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Determines the length of time until the next hydraulic event occurs in an extended period</span>
<span class="sd">       simulation.&quot;&quot;&quot;</span>
    <span class="n">_deltat</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENnextH</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_deltat</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_deltat</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENcloseH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Closes the hydraulic analysis system, freeing all allocated memory.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENcloseH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="c1"># --------------------------------------------</span>

<span class="c1">#----------Running a quality analysis --------------------------</span>
<span class="k">def</span> <span class="nf">ENsolveQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Runs a complete water quality simulation with results </span>
<span class="sd">    at uniform reporting intervals written to EPANET&#39;s binary Output file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsolveQ</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENopenQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Opens the water quality analysis system&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENopenQ</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">ENinitQ</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes water quality and the simulation clock </span>
<span class="sd">    time prior to running a water quality analysis.</span>

<span class="sd">    flag  EN_NOSAVE | EN_SAVE &quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENinitQ</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENrunQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Makes available the hydraulic and water quality results</span>
<span class="sd">    that occur at the start of the next time period of a water quality analysis, </span>
<span class="sd">    where the start of the period is returned in t.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENrunQ</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_current_simulation_time</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">&gt;=</span><span class="mi">100</span><span class="p">:</span> 
      <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">ENgeterror</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENnextQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Advances the water quality simulation </span>
<span class="sd">    to the start of the next hydraulic time period.&quot;&quot;&quot;</span>
    <span class="n">_deltat</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENnextQ</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">_deltat</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_deltat</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">ENstepQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Advances the water quality simulation one water quality time step. </span>
<span class="sd">    The time remaining in the overall simulation is returned in tleft.&quot;&quot;&quot;</span>
    <span class="n">tleft</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">()</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENnextQ</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">tleft</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tleft</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">ENcloseQ</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Closes the water quality analysis system, </span>
<span class="sd">    freeing all allocated memory.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENcloseQ</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<span class="c1">#--------------------------------------------</span>





<span class="k">def</span> <span class="nf">ENsaveH</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Transfers results of a hydraulic simulation </span>
<span class="sd">    from the binary Hydraulics file to the binary</span>
<span class="sd">    Output file, where results are only reported at </span>
<span class="sd">    uniform reporting intervals.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsaveH</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENsaveinpfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes all current network input data to a file </span>
<span class="sd">    using the format of an EPANET input file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsaveinpfile</span><span class="p">(</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ENreport</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Writes a formatted text report on simulation results </span>
<span class="sd">    to the Report file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENreport</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENresetreport</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Clears any report formatting commands </span>
<span class="sd">    </span>
<span class="sd">    that either appeared in the [REPORT] section of the </span>
<span class="sd">    EPANET Input file or were issued with the </span>
<span class="sd">    ENsetreport function&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENresetreport</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENsetreport</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Issues a report formatting command. </span>
<span class="sd">    </span>
<span class="sd">    Formatting commands are the same as used in the </span>
<span class="sd">    [REPORT] section of the EPANET Input file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetreport</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENsetstatusreport</span><span class="p">(</span><span class="n">statuslevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the level of hydraulic status reporting. </span>
<span class="sd">    </span>
<span class="sd">    statuslevel:  level of status reporting  </span>
<span class="sd">                  0 - no status reporting</span>
<span class="sd">                  1 - normal reporting</span>
<span class="sd">                  2 - full status reporting&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENsetstatusreport</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">statuslevel</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ENgeterror</span><span class="p">(</span><span class="n">errcode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the text of the message associated with a particular error or warning code.&quot;&quot;&quot;</span>
    <span class="n">errmsg</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_err_max_char</span><span class="p">)</span>
    <span class="n">_lib</span><span class="o">.</span><span class="n">ENgeterror</span><span class="p">(</span> <span class="n">errcode</span><span class="p">,</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">errmsg</span><span class="p">),</span> <span class="n">_err_max_char</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">errmsg</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">ENwriteline</span><span class="p">(</span><span class="n">line</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes a line of text to the EPANET report file.&quot;&quot;&quot;</span>
    <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENwriteline</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="p">))</span>
    <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ENtoolkitError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ierr</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="o">=</span> <span class="n">ierr</span> <span class="o">&lt;</span> <span class="mi">100</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">=</span> <span class="p">(</span><span class="n">ierr</span><span class="p">,)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">=</span> <span class="n">ENgeterror</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;ENtoolkit Undocumented Error &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: look at text.h in epanet sources&#39;</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>


<span class="c1">#------ functions added from OpenWaterAnalytics ----------------------------------</span>
<span class="c1"># functions not present in original Epanet2 toolkit from US EPA</span>
<span class="c1"># it may change in future versions</span>
<span class="c1">#----------------------------------------------------------------------------------</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_lib</span><span class="p">,</span><span class="s2">&quot;ENgetcurve&quot;</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">ENgetcurve</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">):</span>
       <span class="n">curveid</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
       <span class="n">nValues</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
       <span class="n">xValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">yValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcurve</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">,</span>
                             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">curveid</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">xValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">yValues</span><span class="p">)</span>
		             <span class="p">)</span>
       <span class="c1"># strange behavior of ENgetcurve: it returns also curveID</span>
       <span class="c1"># better split in two distinct functions ....</span>
       <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
       <span class="n">curve</span><span class="o">=</span> <span class="p">[]</span>
       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nValues</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
          <span class="n">curve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">xValues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">yValues</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
       <span class="k">return</span> <span class="n">curve</span>

   <span class="k">def</span> <span class="nf">ENgetcurveid</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">):</span>
       <span class="n">curveid</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_max_label_len</span><span class="p">)</span>
       <span class="n">nValues</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>
       <span class="n">xValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">yValues</span><span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)()</span>
       <span class="n">ierr</span><span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">ENgetcurve</span><span class="p">(</span><span class="n">curveIndex</span><span class="p">,</span>
                             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">curveid</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">xValues</span><span class="p">),</span>
	     	             <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">yValues</span><span class="p">)</span>
		             <span class="p">)</span>
       <span class="c1"># strange behavior of ENgetcurve: it returns also curveID</span>
       <span class="c1"># better split in two distinct functions ....</span>
       <span class="k">if</span> <span class="n">ierr</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ENtoolkitError</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
       <span class="k">return</span> <span class="n">curveid</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># -----end of functions added from OpenWaterAnalytics ----------------------------------</span>


<span class="n">EN_ELEVATION</span>     <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Node parameters */</span>
<span class="n">EN_BASEDEMAND</span>    <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_PATTERN</span>       <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_EMITTER</span>       <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_INITQUAL</span>      <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_SOURCEQUAL</span>    <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_SOURCEPAT</span>     <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_SOURCETYPE</span>    <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_TANKLEVEL</span>     <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_DEMAND</span>        <span class="o">=</span> <span class="mi">9</span>
<span class="n">EN_HEAD</span>          <span class="o">=</span> <span class="mi">10</span>
<span class="n">EN_PRESSURE</span>      <span class="o">=</span> <span class="mi">11</span>
<span class="n">EN_QUALITY</span>       <span class="o">=</span> <span class="mi">12</span>
<span class="n">EN_SOURCEMASS</span>    <span class="o">=</span> <span class="mi">13</span>
<span class="n">EN_INITVOLUME</span>    <span class="o">=</span> <span class="mi">14</span>
<span class="n">EN_MIXMODEL</span>      <span class="o">=</span> <span class="mi">15</span>
<span class="n">EN_MIXZONEVOL</span>    <span class="o">=</span> <span class="mi">16</span>

<span class="n">EN_TANKDIAM</span>      <span class="o">=</span> <span class="mi">17</span>
<span class="n">EN_MINVOLUME</span>     <span class="o">=</span> <span class="mi">18</span>
<span class="n">EN_VOLCURVE</span>      <span class="o">=</span> <span class="mi">19</span>
<span class="n">EN_MINLEVEL</span>      <span class="o">=</span> <span class="mi">20</span>
<span class="n">EN_MAXLEVEL</span>      <span class="o">=</span> <span class="mi">21</span>
<span class="n">EN_MIXFRACTION</span>   <span class="o">=</span> <span class="mi">22</span>
<span class="n">EN_TANK_KBULK</span>    <span class="o">=</span> <span class="mi">23</span>

<span class="n">EN_DIAMETER</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Link parameters */</span>
<span class="n">EN_LENGTH</span>        <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_ROUGHNESS</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_MINORLOSS</span>     <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_INITSTATUS</span>    <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_INITSETTING</span>   <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_KBULK</span>         <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_KWALL</span>         <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_FLOW</span>          <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_VELOCITY</span>      <span class="o">=</span> <span class="mi">9</span>
<span class="n">EN_HEADLOSS</span>      <span class="o">=</span> <span class="mi">10</span>
<span class="n">EN_STATUS</span>        <span class="o">=</span> <span class="mi">11</span>
<span class="n">EN_SETTING</span>       <span class="o">=</span> <span class="mi">12</span>
<span class="n">EN_ENERGY</span>        <span class="o">=</span> <span class="mi">13</span>

<span class="n">EN_DURATION</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Time parameters */</span>
<span class="n">EN_HYDSTEP</span>       <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_QUALSTEP</span>      <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_PATTERNSTEP</span>   <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_PATTERNSTART</span>  <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_REPORTSTEP</span>    <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_REPORTSTART</span>   <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_RULESTEP</span>      <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_STATISTIC</span>     <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_PERIODS</span>       <span class="o">=</span> <span class="mi">9</span>

<span class="n">EN_NODECOUNT</span>     <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Component counts */</span>
<span class="n">EN_TANKCOUNT</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_LINKCOUNT</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_PATCOUNT</span>      <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_CURVECOUNT</span>    <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_CONTROLCOUNT</span>  <span class="o">=</span> <span class="mi">5</span>

<span class="n">EN_JUNCTION</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Node types */</span>
<span class="n">EN_RESERVOIR</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_TANK</span>          <span class="o">=</span> <span class="mi">2</span>

<span class="n">EN_CVPIPE</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Link types */</span>
<span class="n">EN_PIPE</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_PUMP</span>          <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_PRV</span>           <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_PSV</span>           <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_PBV</span>           <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_FCV</span>           <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_TCV</span>           <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_GPV</span>           <span class="o">=</span> <span class="mi">8</span>

<span class="n">EN_NONE</span>          <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Quality analysis types */</span>
<span class="n">EN_CHEM</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_AGE</span>           <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_TRACE</span>         <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_CONCEN</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Source quality types */</span>
<span class="n">EN_MASS</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_SETPOINT</span>      <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_FLOWPACED</span>     <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_CFS</span>           <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Flow units types */</span>
<span class="n">EN_GPM</span>           <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_MGD</span>           <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_IMGD</span>          <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_AFD</span>           <span class="o">=</span> <span class="mi">4</span>
<span class="n">EN_LPS</span>           <span class="o">=</span> <span class="mi">5</span>
<span class="n">EN_LPM</span>           <span class="o">=</span> <span class="mi">6</span>
<span class="n">EN_MLD</span>           <span class="o">=</span> <span class="mi">7</span>
<span class="n">EN_CMH</span>           <span class="o">=</span> <span class="mi">8</span>
<span class="n">EN_CMD</span>           <span class="o">=</span> <span class="mi">9</span>

<span class="n">EN_TRIALS</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Misc. options */</span>
<span class="n">EN_ACCURACY</span>      <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_TOLERANCE</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_EMITEXPON</span>     <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_DEMANDMULT</span>    <span class="o">=</span> <span class="mi">4</span>

<span class="n">EN_LOWLEVEL</span>      <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Control types */</span>
<span class="n">EN_HILEVEL</span>       <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_TIMER</span>         <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_TIMEOFDAY</span>     <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_AVERAGE</span>       <span class="o">=</span> <span class="mi">1</span>      <span class="c1"># /* Time statistic types.    */</span>
<span class="n">EN_MINIMUM</span>       <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_MAXIMUM</span>       <span class="o">=</span> <span class="mi">3</span>
<span class="n">EN_RANGE</span>         <span class="o">=</span> <span class="mi">4</span>

<span class="n">EN_MIX1</span>          <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Tank mixing models */</span>
<span class="n">EN_MIX2</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_FIFO</span>          <span class="o">=</span> <span class="mi">2</span>
<span class="n">EN_LIFO</span>          <span class="o">=</span> <span class="mi">3</span>

<span class="n">EN_NOSAVE</span>        <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># /* Save-results-to-file flag */</span>
<span class="n">EN_SAVE</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">EN_INITFLOW</span>      <span class="o">=</span> <span class="mi">10</span>     <span class="c1"># /* Re-initialize flow flag   */</span>



<span class="n">FlowUnits</span><span class="o">=</span> <span class="p">{</span> <span class="n">EN_CFS</span> <span class="p">:</span><span class="s2">&quot;cfs&quot;</span>   <span class="p">,</span>
             <span class="n">EN_GPM</span> <span class="p">:</span><span class="s2">&quot;gpm&quot;</span>   <span class="p">,</span>
             <span class="n">EN_MGD</span> <span class="p">:</span><span class="s2">&quot;a-f/d&quot;</span> <span class="p">,</span>
             <span class="n">EN_IMGD</span><span class="p">:</span><span class="s2">&quot;mgd&quot;</span>   <span class="p">,</span>
             <span class="n">EN_AFD</span> <span class="p">:</span><span class="s2">&quot;Imgd&quot;</span>  <span class="p">,</span>
             <span class="n">EN_LPS</span> <span class="p">:</span><span class="s2">&quot;L/s&quot;</span>   <span class="p">,</span>
             <span class="n">EN_LPM</span> <span class="p">:</span><span class="s2">&quot;Lpm&quot;</span>   <span class="p">,</span>
             <span class="n">EN_MLD</span> <span class="p">:</span><span class="s2">&quot;m3/h&quot;</span>  <span class="p">,</span>
             <span class="n">EN_CMH</span> <span class="p">:</span><span class="s2">&quot;m3/d&quot;</span>  <span class="p">,</span>
             <span class="n">EN_CMD</span> <span class="p">:</span><span class="s2">&quot;ML/d&quot;</span>  <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lessons/lesson03"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../lesson02/epanet-rules.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">2.5 EPANET Control Rules</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="epanet-rulesGUI.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">3.2 EPANET example using</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Theodore G. Cleveland, Ph.D., P.E., M.ASCE, F.EWRI<br/>
        
            &copy; Copyright 2023.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>